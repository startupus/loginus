# üîê Roadmap: –°–∏—Å—Ç–µ–º–∞ –ê—É—Ç–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏–∏ –∏ –ë–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç–∏

## üìã –û–±–∑–æ—Ä –ø—Ä–æ–µ–∫—Ç–∞

–î–∞–Ω–Ω—ã–π –¥–æ–∫—É–º–µ–Ω—Ç —Å–æ–¥–µ—Ä–∂–∏—Ç –ø–æ–ª–Ω—ã–π –ø–ª–∞–Ω —Ä–µ–∞–ª–∏–∑–∞—Ü–∏–∏ —Å–∏—Å—Ç–µ–º—ã –∞—É—Ç–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏–∏ –∏ –±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç–∏ –¥–ª—è –ª–∏—á–Ω–æ–≥–æ –∫–∞–±–∏–Ω–µ—Ç–∞, –≤–∫–ª—é—á–∞—é—â–µ–π:

1. **–†–∞–∑–¥–µ–ª "–ê–ª–≥–æ—Ä–∏—Ç–º –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏–∏"** - –Ω–∞—Å—Ç—Ä–æ–π–∫–∞ –ø—É—Ç–µ–π –≤—Ö–æ–¥–∞, —Ä–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏–∏ –∏ –º–Ω–æ–≥–æ—Ñ–∞–∫—Ç–æ—Ä–Ω–æ–π –∞—É—Ç–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏–∏
2. **–†–∞–∑–¥–µ–ª "–ë–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å"** - —É–ø—Ä–∞–≤–ª–µ–Ω–∏–µ —Å–ø–æ—Å–æ–±–∞–º–∏ –≤—Ö–æ–¥–∞, –ø–∞—Ä–æ–ª—è–º–∏, —É—Å—Ç—Ä–æ–π—Å—Ç–≤–∞–º–∏ –∏ –∞–∫—Ç–∏–≤–Ω–æ—Å—Ç—å—é

---

## üéØ –¶–µ–ª–∏ —Å–ø—Ä–∏–Ω—Ç–∞

### 1. –ê–ª–≥–æ—Ä–∏—Ç–º –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏–∏ (–ê–¥–º–∏–Ω-–ø–∞–Ω–µ–ª—å)
- ‚úÖ –ù–∞—Å—Ç—Ä–æ–π–∫–∞ –æ–∫–Ω–∞ –≤—Ö–æ–¥–∞ - –ø–æ—Ä—è–¥–æ–∫ –∏ —Ç–∏–ø—ã –æ–∫–æ–Ω –¥–ª—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
- ‚úÖ –ù–∞—Å—Ç—Ä–æ–π–∫–∞ —Ä–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏–∏ - –≤—ã–±–æ—Ä –æ–±—è–∑–∞—Ç–µ–ª—å–Ω—ã—Ö –ø–æ–ª–µ–π –∏ –∏—Ö –ø–æ—Å–ª–µ–¥–æ–≤–∞—Ç–µ–ª—å–Ω–æ—Å—Ç–∏  
- ‚úÖ –ù–∞—Å—Ç—Ä–æ–π–∫–∞ —Ñ–∞–∫—Ç–æ—Ä–æ–≤ –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏–∏ (2FA/MFA) - –æ–±—è–∑–∞—Ç–µ–ª—å–Ω—ã–µ –¥–ª—è –≤—Å–µ—Ö –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π

### 2. –ë–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å (–õ–∏—á–Ω—ã–π –∫–∞–±–∏–Ω–µ—Ç –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è)
- ‚è≥ –¢–µ–∫—É—â–∏–π —Å–ø–æ—Å–æ–± –≤—Ö–æ–¥–∞ - –ø—Ä–æ—Å–º–æ—Ç—Ä –æ–±—è–∑–∞—Ç–µ–ª—å–Ω—ã—Ö –Ω–∞—Å—Ç—Ä–æ–µ–∫ + –¥–æ–±–∞–≤–ª–µ–Ω–∏–µ –¥–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã—Ö —Ñ–∞–∫—Ç–æ—Ä–æ–≤
- ‚è≥ –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ –ø–∞—Ä–æ–ª—è - —Å–º–µ–Ω–∞ –ø–∞—Ä–æ–ª—è —Å –≤–∞–ª–∏–¥–∞—Ü–∏–µ–π
- ‚è≥ –°–ø–æ—Å–æ–±—ã –≤–æ—Å—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∏—è - –≤–∞—Ä–∏–∞–Ω—Ç—ã –≤–æ—Å—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∏—è –¥–æ—Å—Ç—É–ø–∞
- ‚è≥ –ö–æ–Ω—Ç—Ä–æ–ª—å –¥–æ—Å—Ç—É–ø–∞ - –∏—Å—Ç–æ—Ä–∏—è –∞–∫—Ç–∏–≤–Ω–æ—Å—Ç–∏ –Ω–∞ –∞–∫–∫–∞—É–Ω—Ç–µ
- ‚è≥ –í–∞—à–∏ —É—Å—Ç—Ä–æ–π—Å—Ç–≤–∞ - —Å–ø–∏—Å–æ–∫ —É—Å—Ç—Ä–æ–π—Å—Ç–≤ —Å —É–Ω–∏–∫–∞–ª—å–Ω—ã–º–∏ ID
- ‚è≥ –í—ã–π—Ç–∏ –≤–µ–∑–¥–µ - –º–∞—Å—Å–æ–≤—ã–π –≤—ã—Ö–æ–¥ —Å–æ –≤—Å–µ—Ö —É—Å—Ç—Ä–æ–π—Å—Ç–≤

---

## üìä –¢–µ–∫—É—â–µ–µ —Å–æ—Å—Ç–æ—è–Ω–∏–µ (–ê—É–¥–∏—Ç)

### ‚úÖ –ß—Ç–æ —É–∂–µ —Ä–µ–∞–ª–∏–∑–æ–≤–∞–Ω–æ –Ω–∞ –±—ç–∫–µ–Ω–¥–µ:

#### 1. –ë–∞–∑–æ–≤–∞—è –∞—É—Ç–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏—è
- **–§–∞–π–ª—ã:** `backend/src/auth/auth.service.ts`, `backend/src/auth/auth.controller.ts`
- **–§—É–Ω–∫—Ü–∏–æ–Ω–∞–ª:**
  - –†–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—è (`register`) –∏ –ª–æ–≥–∏–Ω (`login`)
  - –ì–µ–Ω–µ—Ä–∞—Ü–∏—è JWT —Ç–æ–∫–µ–Ω–æ–≤ (access + refresh)
  - –í–∞–ª–∏–¥–∞—Ü–∏—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è –ø–æ email/phone + password
  - –ü—Ä–æ–≤–µ—Ä–∫–∞ 2FA/nFA –ø–µ—Ä–µ–¥ –≤—ã–¥–∞—á–µ–π —Ç–æ–∫–µ–Ω–æ–≤
  - –†–µ—Ñ–µ—Ä–∞–ª—å–Ω–∞—è —Å–∏—Å—Ç–µ–º–∞

#### 2. –ú–Ω–æ–≥–æ—Ñ–∞–∫—Ç–æ—Ä–Ω–∞—è –∞—É—Ç–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏—è (nFA)
- **–§–∞–π–ª—ã:** `backend/src/auth/services/nfa.service.ts`
- **–§—É–Ω–∫—Ü–∏–æ–Ω–∞–ª:**
  - –û—Ç–ø—Ä–∞–≤–∫–∞ –∫–æ–¥–æ–≤ –ø–æ Email, Telegram, GitHub
  - –í–µ—Ä–∏—Ñ–∏–∫–∞—Ü–∏—è –∫–æ–¥–æ–≤ –¥–ª—è –∫–∞–∂–¥–æ–≥–æ –º–µ—Ç–æ–¥–∞
  - –ü—Ä–æ–≤–µ—Ä–∫–∞ —Å—Ç–∞—Ç—É—Å–∞ –≤–µ—Ä–∏—Ñ–∏–∫–∞—Ü–∏–∏ (–≤—Å–µ –º–µ—Ç–æ–¥—ã –ø–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω—ã?)
  - –ù–∞—Å—Ç—Ä–æ–π–∫–∞ nFA –¥–ª—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è (`configureNfa`)

#### 3. –ê—É—Ç–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏—è —á–µ—Ä–µ–∑ OAuth –ø—Ä–æ–≤–∞–π–¥–µ—Ä—ã
- **–§–∞–π–ª—ã:** 
  - `backend/src/auth/services/github-auth.service.ts`
  - `backend/src/auth/micro-modules/two-factor/telegram/telegram-2fa.service.ts`
- **–§—É–Ω–∫—Ü–∏–æ–Ω–∞–ª:**
  - GitHub OAuth
  - Telegram OAuth
  - –û—Ç–ø—Ä–∞–≤–∫–∞ –∫–æ–¥–æ–≤ —á–µ—Ä–µ–∑ Telegram Bot

#### 4. Email –∏ SMS —Å–µ—Ä–≤–∏—Å—ã
- **–§–∞–π–ª—ã:** 
  - `backend/src/auth/email.service.ts`
  - `backend/src/auth/sms.service.ts`
- **–§—É–Ω–∫—Ü–∏–æ–Ω–∞–ª:**
  - –û—Ç–ø—Ä–∞–≤–∫–∞ email —Å –∫–æ–¥–∞–º–∏ –≤–µ—Ä–∏—Ñ–∏–∫–∞—Ü–∏–∏
  - –û—Ç–ø—Ä–∞–≤–∫–∞ SMS —á–µ—Ä–µ–∑ Telegram (–∫–∞–∫ fallback)
  - –®–∞–±–ª–æ–Ω—ã –ø–∏—Å–µ–º –¥–ª—è —Ä–∞–∑–Ω—ã—Ö —Å–æ–±—ã—Ç–∏–π

#### 5. –°–µ—Å—Å–∏–∏ –∏ —Ç–æ–∫–µ–Ω—ã
- **–§–∞–π–ª—ã:** 
  - `backend/src/auth/entities/refresh-token.entity.ts`
  - `backend/src/auth/entities/two-factor-code.entity.ts`
- **–§—É–Ω–∫—Ü–∏–æ–Ω–∞–ª:**
  - RefreshToken entity —Å –ø–æ–ª—è–º–∏: `userId`, `token`, `expiresAt`, `isRevoked`, `userAgent`, `ipAddress`
  - TwoFactorCode entity —Å –ø–æ–ª—è–º–∏: `userId`, `code`, `type`, `status`, `verifiedAt`

#### 6. –ë–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å –∏ –∞–∫—Ç–∏–≤–Ω–æ—Å—Ç—å
- **–§–∞–π–ª—ã:** 
  - `backend/src/security/security.service.ts`
  - `backend/src/security/security.controller.ts`
- **–§—É–Ω–∫—Ü–∏–æ–Ω–∞–ª:**
  - `getDevices()` - —Å–ø–∏—Å–æ–∫ —É—Å—Ç—Ä–æ–π—Å—Ç–≤ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è (—á–µ—Ä–µ–∑ refresh tokens)
  - `deleteDevice()` - —É–¥–∞–ª–µ–Ω–∏–µ —É—Å—Ç—Ä–æ–π—Å—Ç–≤–∞ (revoke token)
  - `getActivity()` - –∏—Å—Ç–æ—Ä–∏—è –∞–∫—Ç–∏–≤–Ω–æ—Å—Ç–∏ –∏–∑ audit logs
  - `changePassword()` - —Å–º–µ–Ω–∞ –ø–∞—Ä–æ–ª—è —Å –≤–∞–ª–∏–¥–∞—Ü–∏–µ–π —Å—Ç–∞—Ä–æ–≥–æ
  - `updateAuthMethod()` - –æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ –æ—Å–Ω–æ–≤–Ω–æ–≥–æ —Å–ø–æ—Å–æ–±–∞ –≤—Ö–æ–¥–∞
  - `setupRecoveryMethod()` - –Ω–∞—Å—Ç—Ä–æ–π–∫–∞ —Å–ø–æ—Å–æ–±–∞ –≤–æ—Å—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∏—è

#### 7. –ê—É–¥–∏—Ç –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ
- **–§–∞–π–ª—ã:** `backend/src/audit/audit.service.ts`
- **–§—É–Ω–∫—Ü–∏–æ–Ω–∞–ª:**
  - –õ–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ –≤—Å–µ—Ö —Å–æ–±—ã—Ç–∏–π: login, logout, password-reset, auth-method-change
  - –°–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ userAgent, ipAddress, timestamp
  - API –¥–ª—è –ø–æ–ª—É—á–µ–Ω–∏—è –∏—Å—Ç–æ—Ä–∏–∏: `getUserAuditHistory()`

#### 8. –ê–ª–≥–æ—Ä–∏—Ç–º –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏–∏ (Auth Flow)
- **–§–∞–π–ª—ã:** 
  - `backend/src/admin/admin.controller.ts` (endpoints `/admin/auth-flow`)
  - `backend/src/auth/auth.controller.ts` (endpoint `/auth/flow`)
- **–§—É–Ω–∫—Ü–∏–æ–Ω–∞–ª:**
  - GET `/admin/auth-flow` - –ø–æ–ª—É—á–∏—Ç—å –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—é (login, registration, factors)
  - PUT `/admin/auth-flow` - –æ–±–Ω–æ–≤–∏—Ç—å –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—é
  - GET `/auth/flow` - –ø—É–±–ª–∏—á–Ω–∞—è –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è –¥–ª—è —Ñ–æ—Ä–º –≤—Ö–æ–¥–∞/—Ä–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏–∏
  - –•—Ä–∞–Ω–µ–Ω–∏–µ –≤ settings: `auth_flow_config`

#### 9. User Entity (–ø—Ä–æ—Ñ–∏–ª—å)
- **–§–∞–π–ª:** `backend/src/users/entities/user.entity.ts`
- **–ü–æ–ª—è:**
  - `primaryAuthMethod` - –æ—Å–Ω–æ–≤–Ω–æ–π —Å–ø–æ—Å–æ–± –≤—Ö–æ–¥–∞ (EMAIL, PHONE_TELEGRAM, GITHUB –∏ —Ç.–¥.)
  - `emailAuthType` - —Ç–∏–ø –∞—É—Ç–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏–∏ –¥–ª—è EMAIL ('password' | 'code')
  - `hasEmailCode` - —Ñ–ª–∞–≥ –Ω–∞–ª–∏—á–∏—è email-code –∫–∞–∫ –¥–æ–ø. —Ñ–∞–∫—Ç–æ—Ä–∞
  - `availableAuthMethods` - –∞–∫—Ç–∏–≤–Ω—ã–µ —Å–ø–æ—Å–æ–±—ã –∞—É—Ç–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏–∏
  - `mfaSettings` - –Ω–∞—Å—Ç—Ä–æ–π–∫–∏ MFA (enabled, methods, backupCodes, requiredMethods)
  - `twoFactorEnabled`, `twoFactorMethods` - legacy 2FA
  - OAuth –ø–æ–ª—è: `githubId`, `githubUsername`, `gosuslugiId`, `vkontakteId`
  - –°—Ç–∞—Ç—É—Å—ã –≤–µ—Ä–∏—Ñ–∏–∫–∞—Ü–∏–∏: `emailVerified`, `phoneVerified`, `githubVerified`

### ‚úÖ –ß—Ç–æ —É–∂–µ —Ä–µ–∞–ª–∏–∑–æ–≤–∞–Ω–æ –Ω–∞ —Ñ—Ä–æ–Ω—Ç–µ–Ω–¥–µ:

#### 1. –ê–¥–º–∏–Ω-–ø–∞–Ω–µ–ª—å: AuthFlowBuilderPage
- **–§–∞–π–ª:** `frontend/src/pages/admin/AuthFlowBuilderPage.tsx`
- **–§—É–Ω–∫—Ü–∏–æ–Ω–∞–ª:**
  - Drag & Drop –∫–æ–Ω—Å—Ç—Ä—É–∫—Ç–æ—Ä –¥–ª—è –Ω–∞—Å—Ç—Ä–æ–π–∫–∏ –º–µ—Ç–æ–¥–æ–≤ –≤—Ö–æ–¥–∞
  - –î–≤–µ –∫–æ–ª–æ–Ω–∫–∏: "–û–∫–Ω–æ –≤—Ö–æ–¥–∞" –∏ "–†–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—è"
  - –¢—Ä–µ—Ç—å—è –∫–æ–ª–æ–Ω–∫–∞: "–§–∞–∫—Ç–æ—Ä—ã –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏–∏"
  - –î–æ–±–∞–≤–ª–µ–Ω–∏–µ/—É–¥–∞–ª–µ–Ω–∏–µ –º–µ—Ç–æ–¥–æ–≤ —á–µ—Ä–µ–∑ –º–æ–¥–∞–ª–∫—É `AddAuthMethodModal`
  - –ü–µ—Ä–µ–∫–ª—é—á–µ–Ω–∏–µ primary –º–µ—Ç–æ–¥–∞
  - –ê–≤—Ç–æ—Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ —Å debounce (1 —Å–µ–∫—É–Ω–¥–∞)
  - –ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è —Å API: `authFlowApi.getAuthFlow()`, `authFlowApi.updateAuthFlow()`

#### 2. –°—Ç—Ä–∞–Ω–∏—Ü–∞ –±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç–∏: SecurityPage
- **–§–∞–π–ª:** `frontend/src/pages/SecurityPage.tsx`
- **–§—É–Ω–∫—Ü–∏–æ–Ω–∞–ª:**
  - –ü—Ä–æ–º–æ-–±–ª–æ–∫ "–£—Å–∏–ª–µ–Ω–Ω–∞—è –∑–∞—â–∏—Ç–∞"
  - –°–µ–∫—Ü–∏—è "–°–ø–æ—Å–æ–± –≤—Ö–æ–¥–∞": —Ç–µ–∫—É—â–∏–π —Å–ø–æ—Å–æ–±, –æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ –ø–∞—Ä–æ–ª—è, —Å–ø–æ—Å–æ–±—ã –≤–æ—Å—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∏—è
  - –°–µ–∫—Ü–∏—è "–ö–æ–Ω—Ç—Ä–æ–ª—å –¥–æ—Å—Ç—É–ø–∞": —Å–æ–±—ã—Ç–∏—è, —É—Å—Ç—Ä–æ–π—Å—Ç–≤–∞ (—Å —Å—á–µ—Ç—á–∏–∫–æ–º), –≤—ã—Ö–æ–¥ –≤–µ–∑–¥–µ
  - –°–µ–∫—Ü–∏—è "–î–æ—Å—Ç—É–ø –∫ –≤–∞—à–∏–º –¥–∞–Ω–Ω—ã–º": –≤–Ω–µ—à–Ω–∏–µ –∞–∫–∫–∞—É–Ω—Ç—ã, —É–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –¥–æ—Å—Ç—É–ø–∞–º–∏
  - –ú–æ–¥–∞–ª–∫–∞ `AuthMethodsModal` –¥–ª—è –Ω–∞—Å—Ç—Ä–æ–π–∫–∏ –ø—É—Ç–µ–π –≤—Ö–æ–¥–∞

#### 3. API —Å–µ—Ä–≤–∏—Å—ã
- **–§–∞–π–ª—ã:**
  - `frontend/src/services/api/auth-flow.ts` - —Ä–∞–±–æ—Ç–∞ —Å –∞–ª–≥–æ—Ä–∏—Ç–º–æ–º –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏–∏
  - `frontend/src/services/api/security.ts` - —Ä–∞–±–æ—Ç–∞ —Å –±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å—é (—É—Å—Ç—Ä–æ–π—Å—Ç–≤–∞, –∞–∫—Ç–∏–≤–Ω–æ—Å—Ç—å)
- **–§—É–Ω–∫—Ü–∏–æ–Ω–∞–ª:**
  - `getAuthFlow()`, `updateAuthFlow()`, `getPublicAuthFlow()`
  - `getDevices()`, `deleteDevice()`, `getActivity()`

#### 4. –ö–æ–º–ø–æ–Ω–µ–Ω—Ç—ã
- **–§–∞–π–ª—ã:**
  - `frontend/src/components/admin/MethodColumn.tsx` - –∫–æ–ª–æ–Ω–∫–∞ –º–µ—Ç–æ–¥–æ–≤ —Å drag & drop
  - `frontend/src/components/admin/AddAuthMethodModal.tsx` - –º–æ–¥–∞–ª–∫–∞ –¥–æ–±–∞–≤–ª–µ–Ω–∏—è –º–µ—Ç–æ–¥–∞
  - `frontend/src/components/Modals/AuthMethodsModal.tsx` - –º–æ–¥–∞–ª–∫–∞ –Ω–∞—Å—Ç—Ä–æ–π–∫–∏ —Å–ø–æ—Å–æ–±–æ–≤ –≤—Ö–æ–¥–∞
  - `frontend/src/design-system/composites/SecurityListItem.tsx` - —ç–ª–µ–º–µ–Ω—Ç —Å–ø–∏—Å–∫–∞ –±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç–∏

---

## ‚ö†Ô∏è –ß—Ç–æ –Ω—É–∂–Ω–æ –¥–æ—Ä–∞–±–æ—Ç–∞—Ç—å/—Ä–µ–∞–ª–∏–∑–æ–≤–∞—Ç—å:

### üî¥ –ö–†–ò–¢–ò–ß–ù–´–ï (High Priority)

#### Backend:

1. **Endpoint: –í—ã—Ö–æ–¥ —Å–æ –≤—Å–µ—Ö —É—Å—Ç—Ä–æ–π—Å—Ç–≤**
   - **–ì–¥–µ:** `backend/src/security/security.service.ts`
   - **–ó–∞–¥–∞—á–∞:** –î–æ–±–∞–≤–∏—Ç—å –º–µ—Ç–æ–¥ `logoutFromAllDevices(userId: string)`
   - **–õ–æ–≥–∏–∫–∞:** 
     - –ü–æ–ª—É—á–∏—Ç—å –≤—Å–µ refresh tokens –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
     - –£—Å—Ç–∞–Ω–æ–≤–∏—Ç—å `isRevoked = true` –¥–ª—è –≤—Å–µ—Ö —Ç–æ–∫–µ–Ω–æ–≤
     - –ó–∞–ª–æ–≥–∏—Ä–æ–≤–∞—Ç—å —Å–æ–±—ã—Ç–∏–µ –≤ audit
   - **API:** POST `/security/logout-all`

2. **Endpoint: –ü–æ–ª—É—á–µ–Ω–∏–µ —Ç–µ–∫—É—â–∏—Ö –Ω–∞—Å—Ç—Ä–æ–µ–∫ Auth Flow –¥–ª—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è**
   - **–ì–¥–µ:** –ù–æ–≤—ã–π endpoint –≤ `backend/src/auth/auth.controller.ts`
   - **–ó–∞–¥–∞—á–∞:** –í–æ–∑–≤—Ä–∞—â–∞—Ç—å –æ–±—è–∑–∞—Ç–µ–ª—å–Ω—ã–µ –Ω–∞—Å—Ç—Ä–æ–π–∫–∏ –∏–∑ `auth_flow_config` + –∏–Ω–¥–∏–≤–∏–¥—É–∞–ª—å–Ω—ã–µ –Ω–∞—Å—Ç—Ä–æ–π–∫–∏ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
   - **API:** GET `/auth/user-flow-settings`
   - **–°—Ç—Ä—É–∫—Ç—É—Ä–∞ –æ—Ç–≤–µ—Ç–∞:**
     ```typescript
     {
       mandatory: {
         login: AuthMethod[],      // –û–±—è–∑–∞—Ç–µ–ª—å–Ω—ã–µ –º–µ—Ç–æ–¥—ã –≤—Ö–æ–¥–∞
         factors: AuthMethod[]      // –û–±—è–∑–∞—Ç–µ–ª—å–Ω—ã–µ —Ñ–∞–∫—Ç–æ—Ä—ã 2FA
       },
       user: {
         additionalFactors: AuthMethod[]  // –î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã–µ —Ñ–∞–∫—Ç–æ—Ä—ã, –¥–æ–±–∞–≤–ª–µ–Ω–Ω—ã–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–º
       }
     }
     ```

3. **–õ–æ–≥–∏–∫–∞: –ü—Ä–∏–º–µ–Ω–µ–Ω–∏–µ Auth Flow –ø—Ä–∏ –ª–æ–≥–∏–Ω–µ/—Ä–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏–∏**
   - **–ì–¥–µ:** `backend/src/auth/auth.service.ts`
   - **–ó–∞–¥–∞—á–∞:** –ò—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å `auth_flow_config` –¥–ª—è –æ–ø—Ä–µ–¥–µ–ª–µ–Ω–∏—è –æ–±—è–∑–∞—Ç–µ–ª—å–Ω—ã—Ö —à–∞–≥–æ–≤
   - **–õ–æ–≥–∏–∫–∞:**
     - –ü—Ä–∏ –ª–æ–≥–∏–Ω–µ: –ø—Ä–æ–≤–µ—Ä—è—Ç—å –≤—Å–µ –æ–±—è–∑–∞—Ç–µ–ª—å–Ω—ã–µ —Ñ–∞–∫—Ç–æ—Ä—ã –∏–∑ `factors`
     - –ü—Ä–∏ —Ä–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏–∏: –∑–∞–ø—Ä–∞—à–∏–≤–∞—Ç—å –≤—Å–µ –ø–æ–ª—è –∏–∑ `registration`
     - –í–æ–∑–≤—Ä–∞—â–∞—Ç—å —Å–ª–µ–¥—É—é—â–∏–π –æ–±—è–∑–∞—Ç–µ–ª—å–Ω—ã–π —à–∞–≥, –µ—Å–ª–∏ –Ω–µ –≤—Å–µ –ø—Ä–æ–π–¥–µ–Ω—ã

4. **Entity: DeviceSession (–æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ, –¥–ª—è —É–ª—É—á—à–µ–Ω–∏—è)**
   - **–ì–¥–µ:** –ù–æ–≤–∞—è entity `backend/src/auth/entities/device-session.entity.ts`
   - **–ó–∞–¥–∞—á–∞:** –ë–æ–ª–µ–µ —Å—Ç—Ä—É–∫—Ç—É—Ä–∏—Ä–æ–≤–∞–Ω–Ω–æ–µ —Ö—Ä–∞–Ω–µ–Ω–∏–µ –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏–∏ –æ–± —É—Å—Ç—Ä–æ–π—Å—Ç–≤–∞—Ö
   - **–ü–æ–ª—è:**
     - `id` - UUID —É—Å—Ç—Ä–æ–π—Å—Ç–≤–∞ (—É–Ω–∏–∫–∞–ª—å–Ω—ã–π –∏–¥–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ç–æ—Ä –∫–∞–∫ —É Steam)
     - `userId` - —Å–≤—è–∑—å —Å –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–º
     - `deviceFingerprint` - –æ—Ç–ø–µ—á–∞—Ç–æ–∫ —É—Å—Ç—Ä–æ–π—Å—Ç–≤–∞
     - `deviceName` - –Ω–∞–∑–≤–∞–Ω–∏–µ (–Ω–∞–ø—Ä–∏–º–µ—Ä, "iPhone 13", "Windows PC")
     - `browser` - –±—Ä–∞—É–∑–µ—Ä
     - `os` - –æ–ø–µ—Ä–∞—Ü–∏–æ–Ω–Ω–∞—è —Å–∏—Å—Ç–µ–º–∞
     - `ipAddress` - IP –∞–¥—Ä–µ—Å
     - `location` - –≥–µ–æ–ª–æ–∫–∞—Ü–∏—è (–æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ)
     - `lastActivity` - –ø–æ—Å–ª–µ–¥–Ω—è—è –∞–∫—Ç–∏–≤–Ω–æ—Å—Ç—å
     - `createdAt` - –¥–∞—Ç–∞ –ø–µ—Ä–≤–æ–≥–æ –≤—Ö–æ–¥–∞
     - `isActive` - –∞–∫—Ç–∏–≤–Ω–∞—è –ª–∏ —Å–µ—Å—Å–∏—è

5. **–°–ø–æ—Å–æ–±—ã –≤–æ—Å—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∏—è: —Ä–∞—Å—à–∏—Ä–µ–Ω–∏–µ –ª–æ–≥–∏–∫–∏**
   - **–ì–¥–µ:** `backend/src/security/security.service.ts`
   - **–ó–∞–¥–∞—á–∞:** –ú–µ—Ç–æ–¥ `getAvailableRecoveryMethods(userId: string)`
   - **–õ–æ–≥–∏–∫–∞:**
     - –ê–Ω–∞–ª–∏–∑–∏—Ä–æ–≤–∞—Ç—å, –∫–∞–∫–∏–µ –¥–∞–Ω–Ω—ã–µ –µ—Å—Ç—å —É –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è (email, phone, GitHub, Telegram)
     - –í–æ–∑–≤—Ä–∞—â–∞—Ç—å –¥–æ—Å—Ç—É–ø–Ω—ã–µ –º–µ—Ç–æ–¥—ã –≤–æ—Å—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∏—è
     - –£—á–∏—Ç—ã–≤–∞—Ç—å –≤–µ—Ä–∏—Ñ–∏–∫–∞—Ü–∏—é (—Ç–æ–ª—å–∫–æ –ø—Ä–æ–≤–µ—Ä–µ–Ω–Ω—ã–µ –∫–æ–Ω—Ç–∞–∫—Ç—ã)

#### Frontend:

1. **–ú–æ–¥–∞–ª–∫–∞: –ò–∑–º–µ–Ω–µ–Ω–∏–µ –ø–∞—Ä–æ–ª—è**
   - **–ì–¥–µ:** –ù–æ–≤—ã–π –∫–æ–º–ø–æ–Ω–µ–Ω—Ç `frontend/src/components/Modals/ChangePasswordModal.tsx`
   - **–ó–∞–¥–∞—á–∞:** –§–æ—Ä–º–∞ –¥–ª—è —Å–º–µ–Ω—ã –ø–∞—Ä–æ–ª—è
   - **–ü–æ–ª—è:**
     - –°—Ç–∞—Ä—ã–π –ø–∞—Ä–æ–ª—å (required)
     - –ù–æ–≤—ã–π –ø–∞—Ä–æ–ª—å (required, validation)
     - –ü–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏–µ –Ω–æ–≤–æ–≥–æ –ø–∞—Ä–æ–ª—è (required, match)
   - **API:** POST `/security/password/change`

2. **–°—Ç—Ä–∞–Ω–∏—Ü–∞: –°–ø–æ—Å–æ–±—ã –≤–æ—Å—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∏—è**
   - **–ì–¥–µ:** –ù–æ–≤–∞—è —Å—Ç—Ä–∞–Ω–∏—Ü–∞ `frontend/src/pages/SecurityRecoveryMethodsPage.tsx`
   - **–ó–∞–¥–∞—á–∞:** –û—Ç–æ–±—Ä–∞–∂–µ–Ω–∏–µ –¥–æ—Å—Ç—É–ø–Ω—ã—Ö —Å–ø–æ—Å–æ–±–æ–≤ –≤–æ—Å—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∏—è
   - **–§—É–Ω–∫—Ü–∏–æ–Ω–∞–ª:**
     - –°–ø–∏—Å–æ–∫ –º–µ—Ç–æ–¥–æ–≤: Email, –¢–µ–ª–µ—Ñ–æ–Ω, Telegram, GitHub
     - –°—Ç–∞—Ç—É—Å –∫–∞–∂–¥–æ–≥–æ –º–µ—Ç–æ–¥–∞ (–¥–æ–±–∞–≤–ª–µ–Ω/–Ω–µ –¥–æ–±–∞–≤–ª–µ–Ω, –≤–µ—Ä–∏—Ñ–∏—Ü–∏—Ä–æ–≤–∞–Ω/–Ω–µ—Ç)
     - –ö–Ω–æ–ø–∫–∞ "–î–æ–±–∞–≤–∏—Ç—å —Å–ø–æ—Å–æ–±" –¥–ª—è –∫–∞–∂–¥–æ–≥–æ –º–µ—Ç–æ–¥–∞
     - –ö–Ω–æ–ø–∫–∞ "–í–µ—Ä–∏—Ñ–∏—Ü–∏—Ä–æ–≤–∞—Ç—å" –¥–ª—è –Ω–µ –ø—Ä–æ–≤–µ—Ä–µ–Ω–Ω—ã—Ö
   - **API:** 
     - GET `/security/recovery-methods`
     - POST `/security/recovery-method/setup`

3. **–°—Ç—Ä–∞–Ω–∏—Ü–∞: –°–æ–±—ã—Ç–∏—è (Activity)**
   - **–ì–¥–µ:** –ù–æ–≤–∞—è —Å—Ç—Ä–∞–Ω–∏—Ü–∞ `frontend/src/pages/SecurityActivityPage.tsx`
   - **–ó–∞–¥–∞—á–∞:** –û—Ç–æ–±—Ä–∞–∂–µ–Ω–∏–µ –∏—Å—Ç–æ—Ä–∏–∏ –∞–∫—Ç–∏–≤–Ω–æ—Å—Ç–∏
   - **–§—É–Ω–∫—Ü–∏–æ–Ω–∞–ª:**
     - –°–ø–∏—Å–æ–∫ —Å–æ–±—ã—Ç–∏–π (–ª–æ–≥–∏–Ω, –≤—ã—Ö–æ–¥, —Å–º–µ–Ω–∞ –ø–∞—Ä–æ–ª—è –∏ —Ç.–¥.)
     - –§–∏–ª—å—Ç—Ä—ã: –ø–æ —Ç–∏–ø—É —Å–æ–±—ã—Ç–∏—è, –ø–æ –¥–∞—Ç–µ
     - –ò–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è –æ –∫–∞–∂–¥–æ–º —Å–æ–±—ã—Ç–∏–∏: –¥–∞—Ç–∞, IP, —É—Å—Ç—Ä–æ–π—Å—Ç–≤–æ, –≥–µ–æ–ª–æ–∫–∞—Ü–∏—è
   - **API:** GET `/security/activity`

4. **–°—Ç—Ä–∞–Ω–∏—Ü–∞: –í–∞—à–∏ —É—Å—Ç—Ä–æ–π—Å—Ç–≤–∞**
   - **–ì–¥–µ:** –ù–æ–≤–∞—è —Å—Ç—Ä–∞–Ω–∏—Ü–∞ `frontend/src/pages/SecurityDevicesPage.tsx`
   - **–ó–∞–¥–∞—á–∞:** –û—Ç–æ–±—Ä–∞–∂–µ–Ω–∏–µ —Å–ø–∏—Å–∫–∞ —É—Å—Ç—Ä–æ–π—Å—Ç–≤
   - **–§—É–Ω–∫—Ü–∏–æ–Ω–∞–ª:**
     - –°–ø–∏—Å–æ–∫ —É—Å—Ç—Ä–æ–π—Å—Ç–≤ —Å —É–Ω–∏–∫–∞–ª—å–Ω—ã–º–∏ ID (–∫–∞–∫ —É Steam)
     - –ò–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è: –Ω–∞–∑–≤–∞–Ω–∏–µ, –±—Ä–∞—É–∑–µ—Ä, OS, IP, –ø–æ—Å–ª–µ–¥–Ω—è—è –∞–∫—Ç–∏–≤–Ω–æ—Å—Ç—å
     - –¢–µ–∫—É—â–µ–µ —É—Å—Ç—Ä–æ–π—Å—Ç–≤–æ –ø–æ–º–µ—á–µ–Ω–æ
     - –ö–Ω–æ–ø–∫–∞ "–£–¥–∞–ª–∏—Ç—å" –¥–ª—è –∫–∞–∂–¥–æ–≥–æ —É—Å—Ç—Ä–æ–π—Å—Ç–≤–∞ (–∫—Ä–æ–º–µ —Ç–µ–∫—É—â–µ–≥–æ)
   - **API:** 
     - GET `/security/devices`
     - DELETE `/security/devices/:deviceId`

5. **–ú–æ–¥–∞–ª–∫–∞: –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –¥–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã–º–∏ —Ñ–∞–∫—Ç–æ—Ä–∞–º–∏**
   - **–ì–¥–µ:** –û–±–Ω–æ–≤–∏—Ç—å `frontend/src/components/Modals/AuthMethodsModal.tsx`
   - **–ó–∞–¥–∞—á–∞:** 
     - –ü–æ–∫–∞–∑—ã–≤–∞—Ç—å –æ–±—è–∑–∞—Ç–µ–ª—å–Ω—ã–µ —Ñ–∞–∫—Ç–æ—Ä—ã (readonly, —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–Ω—ã–µ –∞–¥–º–∏–Ω–æ–º)
     - –ü–æ–∫–∞–∑—ã–≤–∞—Ç—å –¥–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã–µ —Ñ–∞–∫—Ç–æ—Ä—ã (–º–æ–∂–µ—Ç –¥–æ–±–∞–≤–ª—è—Ç—å/—É–¥–∞–ª—è—Ç—å –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å)
     - API –¥–ª—è –ø–æ–ª—É—á–µ–Ω–∏—è –¥–æ—Å—Ç—É–ø–Ω—ã—Ö –º–µ—Ç–æ–¥–æ–≤
   - **API:**
     - GET `/auth/user-flow-settings` (–æ–±—è–∑–∞—Ç–µ–ª—å–Ω—ã–µ + –¥–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã–µ)
     - POST `/auth/user-additional-factors` (–¥–æ–±–∞–≤–∏—Ç—å –¥–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã–π —Ñ–∞–∫—Ç–æ—Ä)
     - DELETE `/auth/user-additional-factors/:factorId` (—É–¥–∞–ª–∏—Ç—å –¥–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã–π)

6. **–ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è —Å Auth Flow –Ω–∞ —Å—Ç—Ä–∞–Ω–∏—Ü–∞—Ö –≤—Ö–æ–¥–∞/—Ä–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏–∏**
   - **–ì–¥–µ:** `frontend/src/pages/auth/*.tsx`
   - **–ó–∞–¥–∞—á–∞:**
     - –ó–∞–ø—Ä–∞—à–∏–≤–∞—Ç—å `getPublicAuthFlow()` –ø—Ä–∏ –∑–∞–≥—Ä—É–∑–∫–µ
     - –î–∏–Ω–∞–º–∏—á–µ—Å–∫–∏ —Å—Ç—Ä–æ–∏—Ç—å —Ñ–æ—Ä–º—É –≤—Ö–æ–¥–∞/—Ä–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏–∏ –Ω–∞ –æ—Å–Ω–æ–≤–µ –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–∏
     - –ü–æ—à–∞–≥–æ–≤–æ–µ –ø—Ä–æ—Ö–æ–∂–¥–µ–Ω–∏–µ: –ø–æ–∫–∞–∑—ã–≤–∞—Ç—å —Ç–æ–ª—å–∫–æ —Ç–µ–∫—É—â–∏–π —à–∞–≥
     - –í–∞–ª–∏–¥–∞—Ü–∏—è –Ω–∞ –∫–∞–∂–¥–æ–º —à–∞–≥–µ

### üü° –°–†–ï–î–ù–ò–ô –ü–†–ò–û–†–ò–¢–ï–¢ (Medium Priority)

#### Backend:

1. **–ì–µ–æ–ª–æ–∫–∞—Ü–∏—è –ø–æ IP**
   - **–ó–∞–¥–∞—á–∞:** –î–æ–±–∞–≤–∏—Ç—å –æ–ø—Ä–µ–¥–µ–ª–µ–Ω–∏–µ —Å—Ç—Ä–∞–Ω—ã/–≥–æ—Ä–æ–¥–∞ –ø–æ IP –∞–¥—Ä–µ—Å—É
   - **–ë–∏–±–ª–∏–æ—Ç–µ–∫–∞:** `geoip-lite` –∏–ª–∏ API —Å–µ—Ä–≤–∏—Å (ipapi.co)
   - **–ü—Ä–∏–º–µ–Ω–µ–Ω–∏–µ:** –í `extractDeviceInfo()` –∏ `getActivity()`

2. **Device Fingerprinting**
   - **–ó–∞–¥–∞—á–∞:** –ì–µ–Ω–µ—Ä–∞—Ü–∏—è —É–Ω–∏–∫–∞–ª—å–Ω–æ–≥–æ –æ—Ç–ø–µ—á–∞—Ç–∫–∞ —É—Å—Ç—Ä–æ–π—Å—Ç–≤–∞
   - **–ë–∏–±–ª–∏–æ—Ç–µ–∫–∞:** –ù–∞ —Ñ—Ä–æ–Ω—Ç–µ `fingerprintjs2`, –ø–µ—Ä–µ–¥–∞—á–∞ –Ω–∞ –±—ç–∫
   - **–ü—Ä–∏–º–µ–Ω–µ–Ω–∏–µ:** –î–ª—è –±–æ–ª–µ–µ —Ç–æ—á–Ω–æ–π –∏–¥–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏–∏ —É—Å—Ç—Ä–æ–π—Å—Ç–≤

3. **Email —É–≤–µ–¥–æ–º–ª–µ–Ω–∏—è –æ —Å–æ–±—ã—Ç–∏—è—Ö –±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç–∏**
   - **–ó–∞–¥–∞—á–∞:** –û—Ç–ø—Ä–∞–≤–ª—è—Ç—å email –ø—Ä–∏:
     - –í—Ö–æ–¥–µ —Å –Ω–æ–≤–æ–≥–æ —É—Å—Ç—Ä–æ–π—Å—Ç–≤–∞
     - –°–º–µ–Ω–µ –ø–∞—Ä–æ–ª—è
     - –î–æ–±–∞–≤–ª–µ–Ω–∏–∏ –Ω–æ–≤–æ–≥–æ —Ñ–∞–∫—Ç–æ—Ä–∞ –∞—É—Ç–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏–∏
   - **–ì–¥–µ:** `backend/src/auth/email.service.ts`

4. **Rate limiting –¥–ª—è —Å–º–µ–Ω—ã –ø–∞—Ä–æ–ª—è**
   - **–ó–∞–¥–∞—á–∞:** –û–≥—Ä–∞–Ω–∏—á–∏—Ç—å –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ –ø–æ–ø—ã—Ç–æ–∫ —Å–º–µ–Ω—ã –ø–∞—Ä–æ–ª—è (3 –ø–æ–ø—ã—Ç–∫–∏ –≤ —á–∞—Å)
   - **–ë–∏–±–ª–∏–æ—Ç–µ–∫–∞:** `@nestjs/throttler`

#### Frontend:

1. **–í–∏–∑—É–∞–ª–∏–∑–∞—Ü–∏—è —É—Å—Ç—Ä–æ–π—Å—Ç–≤**
   - **–ó–∞–¥–∞—á–∞:** –ò–∫–æ–Ω–∫–∏ –¥–ª—è —Ä–∞–∑–Ω—ã—Ö —Ç–∏–ø–æ–≤ —É—Å—Ç—Ä–æ–π—Å—Ç–≤ (Desktop, Mobile, Tablet)
   - **–ë–∏–±–ª–∏–æ—Ç–µ–∫–∞:** –ò—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å —Å—É—â–µ—Å—Ç–≤—É—é—â–∏–µ –∏–∫–æ–Ω–∫–∏ –∏–∑ `Icon` –∫–æ–º–ø–æ–Ω–µ–Ω—Ç–∞

2. **–ü–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏–µ –æ–ø–∞—Å–Ω—ã—Ö –¥–µ–π—Å—Ç–≤–∏–π**
   - **–ó–∞–¥–∞—á–∞:** –ú–æ–¥–∞–ª–∫–∞ –ø–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏—è –¥–ª—è:
     - –í—ã—Ö–æ–¥ —Å–æ –≤—Å–µ—Ö —É—Å—Ç—Ä–æ–π—Å—Ç–≤
     - –£–¥–∞–ª–µ–Ω–∏–µ —É—Å—Ç—Ä–æ–π—Å—Ç–≤–∞
     - –£–¥–∞–ª–µ–Ω–∏–µ —Å–ø–æ—Å–æ–±–∞ –≤–æ—Å—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∏—è
   - **–ö–æ–º–ø–æ–Ω–µ–Ω—Ç:** `ConfirmationModal`

3. **–í–∞–ª–∏–¥–∞—Ü–∏—è –ø–∞—Ä–æ–ª—è**
   - **–ó–∞–¥–∞—á–∞:** –í–∏–∑—É–∞–ª—å–Ω—ã–π –∏–Ω–¥–∏–∫–∞—Ç–æ—Ä —Å–∏–ª—ã –ø–∞—Ä–æ–ª—è
   - **–¢—Ä–µ–±–æ–≤–∞–Ω–∏—è:**
     - –ú–∏–Ω–∏–º—É–º 8 —Å–∏–º–≤–æ–ª–æ–≤
     - –ó–∞–≥–ª–∞–≤–Ω—ã–µ –∏ —Å—Ç—Ä–æ—á–Ω—ã–µ –±—É–∫–≤—ã
     - –¶–∏—Ñ—Ä—ã
     - –°–ø–µ—Ü–∏–∞–ª—å–Ω—ã–µ —Å–∏–º–≤–æ–ª—ã

### üü¢ –ù–ò–ó–ö–ò–ô –ü–†–ò–û–†–ò–¢–ï–¢ (Low Priority)

1. **Backup –∫–æ–¥—ã –¥–ª—è nFA**
   - **–ó–∞–¥–∞—á–∞:** –ì–µ–Ω–µ—Ä–∞—Ü–∏—è –∏ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ —Ä–µ–∑–µ—Ä–≤–Ω—ã—Ö –∫–æ–¥–æ–≤
   - **–ì–¥–µ:** `backend/src/auth/services/nfa.service.ts`

2. **–≠–∫—Å–ø–æ—Ä—Ç –∏—Å—Ç–æ—Ä–∏–∏ –∞–∫—Ç–∏–≤–Ω–æ—Å—Ç–∏**
   - **–ó–∞–¥–∞—á–∞:** –°–∫–∞—á–∏–≤–∞–Ω–∏–µ –∏—Å—Ç–æ—Ä–∏–∏ –≤ CSV/PDF
   - **API:** GET `/security/activity/export`

3. **Trusted devices**
   - **–ó–∞–¥–∞—á–∞:** –í–æ–∑–º–æ–∂–Ω–æ—Å—Ç—å –ø–æ–º–µ—Ç–∏—Ç—å —É—Å—Ç—Ä–æ–π—Å—Ç–≤–æ –∫–∞–∫ –¥–æ–≤–µ—Ä–µ–Ω–Ω–æ–µ (–Ω–µ –∑–∞–ø—Ä–∞—à–∏–≤–∞—Ç—å 2FA)

4. **–ë–ª–æ–∫–∏—Ä–æ–≤–∫–∞ –ø–æ–¥–æ–∑—Ä–∏—Ç–µ–ª—å–Ω—ã—Ö –≤—Ö–æ–¥–æ–≤**
   - **–ó–∞–¥–∞—á–∞:** –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∞—è –±–ª–æ–∫–∏—Ä–æ–≤–∫–∞ –ø—Ä–∏ –≤—Ö–æ–¥–µ —Å –Ω–æ–≤–æ–≥–æ IP/—É—Å—Ç—Ä–æ–π—Å—Ç–≤–∞

---

## üìù –î–µ—Ç–∞–ª—å–Ω—ã–π –ø–ª–∞–Ω —Ä–µ–∞–ª–∏–∑–∞—Ü–∏–∏ (Step-by-Step)

### –≠–¢–ê–ü 1: –î–æ—Ä–∞–±–æ—Ç–∫–∞ Backend API (3-4 –¥–Ω—è)

#### –î–µ–Ω—å 1: –£—Å—Ç—Ä–æ–π—Å—Ç–≤–∞ –∏ —Å–µ—Å—Å–∏–∏

**–ó–∞–¥–∞—á–∞ 1.1: Endpoint "–í—ã—Ö–æ–¥ —Å–æ –≤—Å–µ—Ö —É—Å—Ç—Ä–æ–π—Å—Ç–≤"**
```typescript
// backend/src/security/security.service.ts
async logoutFromAllDevices(userId: string, currentTokenId?: string) {
  // 1. –ü–æ–ª—É—á–∏—Ç—å –≤—Å–µ —Ç–æ–∫–µ–Ω—ã –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
  const tokens = await this.refreshTokensRepo.find({
    where: { userId, isRevoked: false }
  });
  
  // 2. –û—Ç–º–µ—Ç–∏—Ç—å –≤—Å–µ –∫–∞–∫ revoked (–∫—Ä–æ–º–µ —Ç–µ–∫—É—â–µ–≥–æ, –µ—Å–ª–∏ –ø–µ—Ä–µ–¥–∞–Ω)
  for (const token of tokens) {
    if (currentTokenId && token.id === currentTokenId) continue;
    token.isRevoked = true;
    await this.refreshTokensRepo.save(token);
  }
  
  // 3. –ó–∞–ª–æ–≥–∏—Ä–æ–≤–∞—Ç—å —Å–æ–±—ã—Ç–∏–µ
  await this.auditService.log({
    userId,
    service: 'security',
    action: 'logout-all-devices',
    resource: 'sessions',
    statusCode: 200,
    ipAddress: 'system',
    userAgent: 'system',
  });
  
  return { message: 'Logged out from all devices', count: tokens.length };
}
```

**–ó–∞–¥–∞—á–∞ 1.2: Controller endpoint**
```typescript
// backend/src/security/security.controller.ts
@Post('logout-all')
@ApiOperation({ summary: '–í—ã–π—Ç–∏ —Å–æ –≤—Å–µ—Ö —É—Å—Ç—Ä–æ–π—Å—Ç–≤' })
@ApiResponse({ status: 200, description: '–í—ã—Ö–æ–¥ –≤—ã–ø–æ–ª–Ω–µ–Ω' })
async logoutFromAllDevices(
  @CurrentUser() user: any,
  @Body() body: { keepCurrentSession?: boolean }
) {
  const userId = user?.userId || user?.id || user?.sub;
  const currentTokenId = body.keepCurrentSession ? user?.tokenId : undefined;
  return this.securityService.logoutFromAllDevices(userId, currentTokenId);
}
```

**–ó–∞–¥–∞—á–∞ 1.3: –¢–µ—Å—Ç—ã**
- –°–æ–∑–¥–∞—Ç—å —Ç–µ—Å—Ç –¥–ª—è `logoutFromAllDevices()`
- –ü—Ä–æ–≤–µ—Ä–∏—Ç—å, —á—Ç–æ –≤—Å–µ —Ç–æ–∫–µ–Ω—ã —Å—Ç–∞–ª–∏ revoked
- –ü—Ä–æ–≤–µ—Ä–∏—Ç—å, —á—Ç–æ —Å–æ–±—ã—Ç–∏–µ –∑–∞–ª–æ–≥–∏—Ä–æ–≤–∞–Ω–æ

#### –î–µ–Ω—å 2: Auth Flow –¥–ª—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π

**–ó–∞–¥–∞—á–∞ 2.1: Endpoint –Ω–∞—Å—Ç—Ä–æ–µ–∫ –¥–ª—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è**
```typescript
// backend/src/auth/auth.controller.ts
@Get('user-flow-settings')
@UseGuards(JwtAuthGuard)
@ApiOperation({ summary: '–ü–æ–ª—É—á–∏—Ç—å –Ω–∞—Å—Ç—Ä–æ–π–∫–∏ Auth Flow –¥–ª—è —Ç–µ–∫—É—â–µ–≥–æ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è' })
async getUserFlowSettings(@CurrentUser() user: any) {
  const userId = user?.userId || user?.id || user?.sub;
  
  // 1. –ü–æ–ª—É—á–∏—Ç—å –æ–±—è–∑–∞—Ç–µ–ª—å–Ω—ã–µ –Ω–∞—Å—Ç—Ä–æ–π–∫–∏ –∏–∑ auth_flow_config
  const configRaw = await this.settingsService.getSetting('auth_flow_config');
  const config = configRaw ? JSON.parse(configRaw) : { login: [], factors: [] };
  
  // 2. –ü–æ–ª—É—á–∏—Ç—å –∏–Ω–¥–∏–≤–∏–¥—É–∞–ª—å–Ω—ã–µ –Ω–∞—Å—Ç—Ä–æ–π–∫–∏ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
  const userEntity = await this.usersService.findById(userId);
  const additionalFactors = userEntity?.mfaSettings?.methods || [];
  
  return {
    success: true,
    data: {
      mandatory: {
        login: config.login || [],
        factors: config.factors || []
      },
      user: {
        additionalFactors: additionalFactors.map(method => ({
          id: method,
          name: method,
          enabled: true,
          type: 'user-added'
        }))
      }
    }
  };
}
```

**–ó–∞–¥–∞—á–∞ 2.2: Endpoint –¥–æ–±–∞–≤–ª–µ–Ω–∏—è –¥–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã—Ö —Ñ–∞–∫—Ç–æ—Ä–æ–≤**
```typescript
// backend/src/auth/auth.controller.ts
@Post('user-additional-factors')
@UseGuards(JwtAuthGuard)
@ApiOperation({ summary: '–î–æ–±–∞–≤–∏—Ç—å –¥–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã–π —Ñ–∞–∫—Ç–æ—Ä –∞—É—Ç–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏–∏' })
async addUserAdditionalFactor(
  @CurrentUser() user: any,
  @Body() body: { method: string }
) {
  const userId = user?.userId || user?.id || user?.sub;
  const userEntity = await this.usersService.findById(userId);
  
  // –ü—Ä–æ–≤–µ—Ä—è–µ–º, —á—Ç–æ –º–µ—Ç–æ–¥ –¥–æ—Å—Ç—É–ø–µ–Ω –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—é
  const availableMethods = userEntity.availableAuthMethods || [];
  if (!availableMethods.includes(body.method)) {
    throw new BadRequestException('Method not available for this user');
  }
  
  // –î–æ–±–∞–≤–ª—è–µ–º –º–µ—Ç–æ–¥ –≤ mfaSettings
  if (!userEntity.mfaSettings) {
    userEntity.mfaSettings = {
      enabled: true,
      methods: [body.method],
      backupCodes: [],
      backupCodesUsed: [],
      requiredMethods: 1
    };
  } else {
    if (!userEntity.mfaSettings.methods.includes(body.method)) {
      userEntity.mfaSettings.methods.push(body.method);
    }
  }
  
  await this.usersService.update(userId, { mfaSettings: userEntity.mfaSettings });
  
  return {
    success: true,
    message: 'Additional factor added'
  };
}

@Delete('user-additional-factors/:method')
@UseGuards(JwtAuthGuard)
@ApiOperation({ summary: '–£–¥–∞–ª–∏—Ç—å –¥–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã–π —Ñ–∞–∫—Ç–æ—Ä –∞—É—Ç–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏–∏' })
async removeUserAdditionalFactor(
  @CurrentUser() user: any,
  @Param('method') method: string
) {
  const userId = user?.userId || user?.id || user?.sub;
  const userEntity = await this.usersService.findById(userId);
  
  // –£–¥–∞–ª—è–µ–º –º–µ—Ç–æ–¥ –∏–∑ mfaSettings (–µ—Å–ª–∏ —ç—Ç–æ –Ω–µ –æ–±—è–∑–∞—Ç–µ–ª—å–Ω—ã–π –º–µ—Ç–æ–¥ –∏–∑ auth_flow_config)
  if (userEntity.mfaSettings) {
    userEntity.mfaSettings.methods = userEntity.mfaSettings.methods.filter(m => m !== method);
    if (userEntity.mfaSettings.methods.length === 0) {
      userEntity.mfaSettings.enabled = false;
    }
  }
  
  await this.usersService.update(userId, { mfaSettings: userEntity.mfaSettings });
  
  return {
    success: true,
    message: 'Additional factor removed'
  };
}
```

#### –î–µ–Ω—å 3: –°–ø–æ—Å–æ–±—ã –≤–æ—Å—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∏—è

**–ó–∞–¥–∞—á–∞ 3.1: Endpoint –¥–æ—Å—Ç—É–ø–Ω—ã—Ö —Å–ø–æ—Å–æ–±–æ–≤ –≤–æ—Å—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∏—è**
```typescript
// backend/src/security/security.service.ts
async getAvailableRecoveryMethods(userId: string) {
  const user = await this.usersService.findById(userId);
  if (!user) {
    throw new Error('User not found');
  }
  
  const methods = [];
  
  // Email
  if (user.email) {
    methods.push({
      type: 'email',
      contact: user.email,
      verified: user.emailVerified,
      primary: user.primaryAuthMethod === 'EMAIL'
    });
  }
  
  // Phone / Telegram
  if (user.phone || user.messengerMetadata?.telegram) {
    methods.push({
      type: 'phone_telegram',
      contact: user.phone || user.messengerMetadata?.telegram?.username,
      verified: user.phoneVerified,
      primary: user.primaryAuthMethod === 'PHONE_TELEGRAM'
    });
  }
  
  // GitHub
  if (user.githubId) {
    methods.push({
      type: 'github',
      contact: user.githubUsername,
      verified: user.githubVerified,
      primary: user.primaryAuthMethod === 'GITHUB'
    });
  }
  
  return {
    success: true,
    data: { methods }
  };
}
```

**–ó–∞–¥–∞—á–∞ 3.2: Controller endpoint**
```typescript
// backend/src/security/security.controller.ts
@Get('recovery-methods')
@ApiOperation({ summary: '–ü–æ–ª—É—á–∏—Ç—å –¥–æ—Å—Ç—É–ø–Ω—ã–µ —Å–ø–æ—Å–æ–±—ã –≤–æ—Å—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∏—è' })
@ApiResponse({ status: 200, description: '–°–ø–∏—Å–æ–∫ —Å–ø–æ—Å–æ–±–æ–≤ –≤–æ—Å—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∏—è' })
async getRecoveryMethods(@CurrentUser() user: any) {
  const userId = user?.userId || user?.id || user?.sub;
  return this.securityService.getAvailableRecoveryMethods(userId);
}
```

#### –î–µ–Ω—å 4: –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ –∏ –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è

- –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ –≤—Å–µ—Ö –Ω–æ–≤—ã—Ö endpoints
- –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ Swagger –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏–∏
- –ü—Ä–æ–≤–µ—Ä–∫–∞ —Ä–∞–±–æ—Ç—ã —Å Docker

---

### –≠–¢–ê–ü 2: –î–æ—Ä–∞–±–æ—Ç–∫–∞ Frontend (4-5 –¥–Ω–µ–π)

#### –î–µ–Ω—å 5: –ú–æ–¥–∞–ª–∫–∞ –∏–∑–º–µ–Ω–µ–Ω–∏—è –ø–∞—Ä–æ–ª—è

**–ó–∞–¥–∞—á–∞ 5.1: –°–æ–∑–¥–∞—Ç—å –∫–æ–º–ø–æ–Ω–µ–Ω—Ç ChangePasswordModal**
```typescript
// frontend/src/components/Modals/ChangePasswordModal.tsx
import React, { useState } from 'react';
import { useTranslation } from 'react-i18next';
import { Modal } from '@/design-system/composites/Modal';
import { Input } from '@/design-system/primitives/Input';
import { Button } from '@/design-system/primitives/Button';
import { securityApi } from '@/services/api/security';

interface ChangePasswordModalProps {
  isOpen: boolean;
  onClose: () => void;
  onSuccess?: () => void;
}

export const ChangePasswordModal: React.FC<ChangePasswordModalProps> = ({
  isOpen,
  onClose,
  onSuccess
}) => {
  const { t } = useTranslation();
  const [oldPassword, setOldPassword] = useState('');
  const [newPassword, setNewPassword] = useState('');
  const [confirmPassword, setConfirmPassword] = useState('');
  const [error, setError] = useState('');
  const [isLoading, setIsLoading] = useState(false);
  
  const validatePassword = (password: string) => {
    if (password.length < 8) return false;
    if (!/[A-Z]/.test(password)) return false;
    if (!/[a-z]/.test(password)) return false;
    if (!/[0-9]/.test(password)) return false;
    return true;
  };
  
  const handleSubmit = async () => {
    setError('');
    
    if (!oldPassword || !newPassword || !confirmPassword) {
      setError(t('errors.requiredFields', '–ó–∞–ø–æ–ª–Ω–∏—Ç–µ –≤—Å–µ –ø–æ–ª—è'));
      return;
    }
    
    if (newPassword !== confirmPassword) {
      setError(t('errors.passwordsDoNotMatch', '–ü–∞—Ä–æ–ª–∏ –Ω–µ —Å–æ–≤–ø–∞–¥–∞—é—Ç'));
      return;
    }
    
    if (!validatePassword(newPassword)) {
      setError(t('errors.weakPassword', '–ü–∞—Ä–æ–ª—å –¥–æ–ª–∂–µ–Ω —Å–æ–¥–µ—Ä–∂–∞—Ç—å –º–∏–Ω–∏–º—É–º 8 —Å–∏–º–≤–æ–ª–æ–≤, –∑–∞–≥–ª–∞–≤–Ω—ã–µ –∏ —Å—Ç—Ä–æ—á–Ω—ã–µ –±—É–∫–≤—ã, —Ü–∏—Ñ—Ä—ã'));
      return;
    }
    
    setIsLoading(true);
    
    try {
      await securityApi.changePassword(oldPassword, newPassword);
      onSuccess?.();
      onClose();
    } catch (err: any) {
      setError(err?.response?.data?.message || t('errors.changePasswordFailed', '–û—à–∏–±–∫–∞ –∏–∑–º–µ–Ω–µ–Ω–∏—è –ø–∞—Ä–æ–ª—è'));
    } finally {
      setIsLoading(false);
    }
  };
  
  return (
    <Modal isOpen={isOpen} onClose={onClose} title={t('security.password.change', '–ò–∑–º–µ–Ω–∏—Ç—å –ø–∞—Ä–æ–ª—å')}>
      <div className="space-y-4">
        <Input
          type="password"
          label={t('security.password.old', '–°—Ç–∞—Ä—ã–π –ø–∞—Ä–æ–ª—å')}
          value={oldPassword}
          onChange={(e) => setOldPassword(e.target.value)}
        />
        <Input
          type="password"
          label={t('security.password.new', '–ù–æ–≤—ã–π –ø–∞—Ä–æ–ª—å')}
          value={newPassword}
          onChange={(e) => setNewPassword(e.target.value)}
        />
        <Input
          type="password"
          label={t('security.password.confirm', '–ü–æ–¥—Ç–≤–µ—Ä–¥–∏—Ç–µ –Ω–æ–≤—ã–π –ø–∞—Ä–æ–ª—å')}
          value={confirmPassword}
          onChange={(e) => setConfirmPassword(e.target.value)}
        />
        {error && <div className="text-red-500 text-sm">{error}</div>}
        <div className="flex gap-2 justify-end">
          <Button variant="outline" onClick={onClose} disabled={isLoading}>
            {t('common.cancel', '–û—Ç–º–µ–Ω–∞')}
          </Button>
          <Button onClick={handleSubmit} loading={isLoading}>
            {t('common.save', '–°–æ—Ö—Ä–∞–Ω–∏—Ç—å')}
          </Button>
        </div>
      </div>
    </Modal>
  );
};
```

**–ó–∞–¥–∞—á–∞ 5.2: –î–æ–±–∞–≤–∏—Ç—å API –º–µ—Ç–æ–¥—ã**
```typescript
// frontend/src/services/api/security.ts
export const securityApi = {
  // ... existing methods
  
  changePassword: (oldPassword: string, newPassword: string) =>
    apiClient.post('/security/password/change', { oldPassword, newPassword }),
  
  logoutFromAllDevices: (keepCurrentSession: boolean = false) =>
    apiClient.post('/security/logout-all', { keepCurrentSession }),
};
```

**–ó–∞–¥–∞—á–∞ 5.3: –ò–Ω—Ç–µ–≥—Ä–∏—Ä–æ–≤–∞—Ç—å –≤ SecurityPage**
```typescript
// frontend/src/pages/SecurityPage.tsx
import { ChangePasswordModal } from '@/components/Modals/ChangePasswordModal';

// –í –∫–æ–º–ø–æ–Ω–µ–Ω—Ç–µ:
const changePasswordModal = useModal();

// –í —Å–ø–∏—Å–∫–µ:
<SecurityListItem
  icon="refresh-cw"
  title={t('security.password.change', '–û–±–Ω–æ–≤–∏—Ç—å –ø–∞—Ä–æ–ª—å')}
  description={t('security.password.lastChanged', '–ú–µ–Ω—è–ª—Å—è {{time}}', { time: passwordLastChanged })}
  onClick={changePasswordModal.open}
/>

// –í –∫–æ–Ω—Ü–µ:
{changePasswordModal.isOpen && (
  <Suspense fallback={null}>
    <ChangePasswordModal
      isOpen={changePasswordModal.isOpen}
      onClose={changePasswordModal.close}
      onSuccess={() => {
        // –ü–æ–∫–∞–∑–∞—Ç—å —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–µ –æ–± —É—Å–ø–µ—Ö–µ
        console.log('Password changed successfully');
      }}
    />
  </Suspense>
)}
```

#### –î–µ–Ω—å 6: –°—Ç—Ä–∞–Ω–∏—Ü–∞ "–°–ø–æ—Å–æ–±—ã –≤–æ—Å—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∏—è"

**–ó–∞–¥–∞—á–∞ 6.1: –°–æ–∑–¥–∞—Ç—å SecurityRecoveryMethodsPage**
```typescript
// frontend/src/pages/SecurityRecoveryMethodsPage.tsx
import React, { useState, useEffect } from 'react';
import { useTranslation } from 'react-i18next';
import { PageTemplate } from '@/design-system/layouts/PageTemplate';
import { DataSection } from '@/design-system/composites/DataSection';
import { SecurityListItem } from '@/design-system/composites/SecurityListItem';
import { securityApi } from '@/services/api/security';

interface RecoveryMethod {
  type: string;
  contact: string;
  verified: boolean;
  primary: boolean;
}

const SecurityRecoveryMethodsPage: React.FC = () => {
  const { t } = useTranslation();
  const [methods, setMethods] = useState<RecoveryMethod[]>([]);
  const [loading, setLoading] = useState(true);
  
  useEffect(() => {
    const fetchMethods = async () => {
      try {
        const response = await securityApi.getRecoveryMethods();
        setMethods(response.data?.data?.methods || []);
      } catch (error) {
        console.error('Failed to fetch recovery methods', error);
      } finally {
        setLoading(false);
      }
    };
    
    fetchMethods();
  }, []);
  
  const getMethodIcon = (type: string) => {
    switch (type) {
      case 'email': return 'mail';
      case 'phone_telegram': return 'message-circle';
      case 'github': return 'github';
      default: return 'shield';
    }
  };
  
  const getMethodTitle = (type: string) => {
    switch (type) {
      case 'email': return t('recovery.email', 'Email');
      case 'phone_telegram': return t('recovery.telegram', 'Telegram');
      case 'github': return t('recovery.github', 'GitHub');
      default: return type;
    }
  };
  
  return (
    <PageTemplate title={t('security.recovery.title', '–°–ø–æ—Å–æ–±—ã –≤–æ—Å—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∏—è')}>
      <DataSection
        title={t('security.recovery.title', '–°–ø–æ—Å–æ–±—ã –≤–æ—Å—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∏—è')}
        description={t('security.recovery.description', '–í–∞—Ä–∏–∞–Ω—Ç—ã –≤–æ—Å—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∏—è –¥–æ—Å—Ç—É–ø–∞ –∫ –∞–∫–∫–∞—É–Ω—Ç—É')}
      >
        {loading ? (
          <div>Loading...</div>
        ) : (
          <div className="space-y-2">
            {methods.map((method) => (
              <SecurityListItem
                key={method.type}
                icon={getMethodIcon(method.type)}
                title={getMethodTitle(method.type)}
                description={method.contact}
                badge={method.verified ? '–ü—Ä–æ–≤–µ—Ä–µ–Ω–æ' : '–ù–µ –ø—Ä–æ–≤–µ—Ä–µ–Ω–æ'}
                onClick={() => {
                  // TODO: –û—Ç–∫—Ä—ã—Ç—å –º–æ–¥–∞–ª–∫—É –≤–µ—Ä–∏—Ñ–∏–∫–∞—Ü–∏–∏/–Ω–∞—Å—Ç—Ä–æ–π–∫–∏
                }}
              />
            ))}
          </div>
        )}
      </DataSection>
    </PageTemplate>
  );
};

export default SecurityRecoveryMethodsPage;
```

**–ó–∞–¥–∞—á–∞ 6.2: –î–æ–±–∞–≤–∏—Ç—å —Ä–æ—É—Ç**
```typescript
// frontend/src/router/index.tsx
{
  path: '/:lang/security/recovery-methods',
  element: (
    <LanguageRoute>
      <ProtectedRoute>
        <Suspense fallback={<LoadingFallback />}>
          <SecurityRecoveryMethodsPage />
        </Suspense>
      </ProtectedRoute>
    </LanguageRoute>
  ),
},
```

**–ó–∞–¥–∞—á–∞ 6.3: –î–æ–±–∞–≤–∏—Ç—å API –º–µ—Ç–æ–¥**
```typescript
// frontend/src/services/api/security.ts
export const securityApi = {
  // ... existing methods
  
  getRecoveryMethods: () => apiClient.get('/security/recovery-methods'),
  
  setupRecoveryMethod: (method: 'email' | 'phone') =>
    apiClient.post('/security/recovery-method/setup', { method }),
};
```

#### –î–µ–Ω—å 7: –°—Ç—Ä–∞–Ω–∏—Ü–∞ "–°–æ–±—ã—Ç–∏—è (Activity)"

**–ó–∞–¥–∞—á–∞ 7.1: –°–æ–∑–¥–∞—Ç—å SecurityActivityPage**
```typescript
// frontend/src/pages/SecurityActivityPage.tsx
import React, { useState, useEffect } from 'react';
import { useTranslation } from 'react-i18next';
import { PageTemplate } from '@/design-system/layouts/PageTemplate';
import { DataSection } from '@/design-system/composites/DataSection';
import { securityApi } from '@/services/api/security';
import { formatDistanceToNow } from 'date-fns';
import { ru } from 'date-fns/locale';

interface Activity {
  id: string;
  action: string;
  date: string;
  ip: string;
  device: string;
  location?: string;
}

const SecurityActivityPage: React.FC = () => {
  const { t } = useTranslation();
  const [activities, setActivities] = useState<Activity[]>([]);
  const [loading, setLoading] = useState(true);
  
  useEffect(() => {
    const fetchActivity = async () => {
      try {
        const response = await securityApi.getActivity();
        setActivities(response.data?.activity || []);
      } catch (error) {
        console.error('Failed to fetch activity', error);
      } finally {
        setLoading(false);
      }
    };
    
    fetchActivity();
  }, []);
  
  return (
    <PageTemplate title={t('security.activity.title', '–°–æ–±—ã—Ç–∏—è')}>
      <DataSection
        title={t('security.activity.title', '–°–æ–±—ã—Ç–∏—è')}
        description={t('security.activity.description', '–ò—Å—Ç–æ—Ä–∏—è –∞–∫—Ç–∏–≤–Ω–æ—Å—Ç–∏ –Ω–∞ –∞–∫–∫–∞—É–Ω—Ç–µ –∑–∞ –ø–æ—Å–ª–µ–¥–Ω–∏–µ 180 –¥–Ω–µ–π')}
      >
        {loading ? (
          <div>Loading...</div>
        ) : (
          <div className="space-y-4">
            {activities.map((activity) => (
              <div key={activity.id} className="border rounded-lg p-4">
                <div className="flex justify-between">
                  <div>
                    <h4 className="font-medium">{activity.action}</h4>
                    <p className="text-sm text-gray-500">
                      {activity.device} ‚Ä¢ {activity.ip}
                    </p>
                  </div>
                  <div className="text-sm text-gray-500">
                    {formatDistanceToNow(new Date(activity.date), { 
                      addSuffix: true,
                      locale: ru 
                    })}
                  </div>
                </div>
              </div>
            ))}
          </div>
        )}
      </DataSection>
    </PageTemplate>
  );
};

export default SecurityActivityPage;
```

**–ó–∞–¥–∞—á–∞ 7.2: –î–æ–±–∞–≤–∏—Ç—å —Ä–æ—É—Ç**
```typescript
// frontend/src/router/index.tsx
{
  path: '/:lang/security/activity',
  element: (
    <LanguageRoute>
      <ProtectedRoute>
        <Suspense fallback={<LoadingFallback />}>
          <SecurityActivityPage />
        </Suspense>
      </ProtectedRoute>
    </LanguageRoute>
  ),
},
```

#### –î–µ–Ω—å 8: –°—Ç—Ä–∞–Ω–∏—Ü–∞ "–í–∞—à–∏ —É—Å—Ç—Ä–æ–π—Å—Ç–≤–∞"

**–ó–∞–¥–∞—á–∞ 8.1: –°–æ–∑–¥–∞—Ç—å SecurityDevicesPage**
```typescript
// frontend/src/pages/SecurityDevicesPage.tsx
import React, { useState, useEffect } from 'react';
import { useTranslation } from 'react-i18next';
import { PageTemplate } from '@/design-system/layouts/PageTemplate';
import { DataSection } from '@/design-system/composites/DataSection';
import { Button } from '@/design-system/primitives/Button';
import { Icon } from '@/design-system/primitives/Icon';
import { securityApi } from '@/services/api/security';
import { formatDistanceToNow } from 'date-fns';
import { ru } from 'date-fns/locale';

interface Device {
  id: string;
  device: string;
  browser: string;
  ip: string;
  location?: string;
  lastActivity: string;
  current: boolean;
}

const SecurityDevicesPage: React.FC = () => {
  const { t } = useTranslation();
  const [devices, setDevices] = useState<Device[]>([]);
  const [loading, setLoading] = useState(true);
  
  useEffect(() => {
    fetchDevices();
  }, []);
  
  const fetchDevices = async () => {
    try {
      const response = await securityApi.getDevices();
      setDevices(response.data || []);
    } catch (error) {
      console.error('Failed to fetch devices', error);
    } finally {
      setLoading(false);
    }
  };
  
  const handleDeleteDevice = async (deviceId: string) => {
    if (!confirm(t('security.devices.confirmDelete', '–£–¥–∞–ª–∏—Ç—å —ç—Ç–æ —É—Å—Ç—Ä–æ–π—Å—Ç–≤–æ?'))) {
      return;
    }
    
    try {
      await securityApi.deleteDevice(deviceId);
      await fetchDevices();
    } catch (error) {
      console.error('Failed to delete device', error);
    }
  };
  
  const getDeviceIcon = (deviceName: string) => {
    if (deviceName.includes('iPhone') || deviceName.includes('Android')) {
      return 'smartphone';
    }
    if (deviceName.includes('iPad') || deviceName.includes('Tablet')) {
      return 'tablet';
    }
    return 'monitor';
  };
  
  return (
    <PageTemplate title={t('security.devices.title', '–í–∞—à–∏ —É—Å—Ç—Ä–æ–π—Å—Ç–≤–∞')}>
      <DataSection
        title={t('security.devices.title', '–í–∞—à–∏ —É—Å—Ç—Ä–æ–π—Å—Ç–≤–∞')}
        description={t('security.devices.description', '–£—Å—Ç—Ä–æ–π—Å—Ç–≤–∞, —Å –∫–æ—Ç–æ—Ä—ã—Ö –≤—ã –≤—Ö–æ–¥–∏–ª–∏ –≤ Loginus')}
      >
        {loading ? (
          <div>Loading...</div>
        ) : (
          <div className="space-y-4">
            {devices.map((device) => (
              <div key={device.id} className="border rounded-lg p-4">
                <div className="flex items-start justify-between">
                  <div className="flex gap-4">
                    <Icon name={getDeviceIcon(device.device)} size="lg" />
                    <div>
                      <h4 className="font-medium">
                        {device.device}
                        {device.current && (
                          <span className="ml-2 text-xs bg-blue-100 text-blue-800 px-2 py-1 rounded">
                            {t('security.devices.current', '–¢–µ–∫—É—â–µ–µ')}
                          </span>
                        )}
                      </h4>
                      <p className="text-sm text-gray-500">
                        {device.browser} ‚Ä¢ {device.ip}
                      </p>
                      <p className="text-sm text-gray-500">
                        {t('security.devices.lastActive', '–ü–æ—Å–ª–µ–¥–Ω—è—è –∞–∫—Ç–∏–≤–Ω–æ—Å—Ç—å')}: {' '}
                        {formatDistanceToNow(new Date(device.lastActivity), { 
                          addSuffix: true,
                          locale: ru 
                        })}
                      </p>
                    </div>
                  </div>
                  {!device.current && (
                    <Button 
                      variant="outline" 
                      size="sm"
                      onClick={() => handleDeleteDevice(device.id)}
                    >
                      {t('common.delete', '–£–¥–∞–ª–∏—Ç—å')}
                    </Button>
                  )}
                </div>
              </div>
            ))}
          </div>
        )}
      </DataSection>
    </PageTemplate>
  );
};

export default SecurityDevicesPage;
```

**–ó–∞–¥–∞—á–∞ 8.2: –î–æ–±–∞–≤–∏—Ç—å —Ä–æ—É—Ç**
```typescript
// frontend/src/router/index.tsx
{
  path: '/:lang/security/devices',
  element: (
    <LanguageRoute>
      <ProtectedRoute>
        <Suspense fallback={<LoadingFallback />}>
          <SecurityDevicesPage />
        </Suspense>
      </ProtectedRoute>
    </LanguageRoute>
  ),
},
```

**–ó–∞–¥–∞—á–∞ 8.3: –î–æ–±–∞–≤–∏—Ç—å API –º–µ—Ç–æ–¥—ã**
```typescript
// frontend/src/services/api/security.ts
export const securityApi = {
  // ... existing methods
  
  getDevices: () => apiClient.get('/security/devices'),
  
  deleteDevice: (deviceId: string) => apiClient.delete(`/security/devices/${deviceId}`),
};
```

#### –î–µ–Ω—å 9: –ú–æ–¥–∞–ª–∫–∞ —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è –¥–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã–º–∏ —Ñ–∞–∫—Ç–æ—Ä–∞–º–∏

**–ó–∞–¥–∞—á–∞ 9.1: –û–±–Ω–æ–≤–∏—Ç—å AuthMethodsModal**
```typescript
// frontend/src/components/Modals/AuthMethodsModal.tsx
import React, { useState, useEffect } from 'react';
import { useTranslation } from 'react-i18next';
import { Modal } from '@/design-system/composites/Modal';
import { Button } from '@/design-system/primitives/Button';
import { Icon } from '@/design-system/primitives/Icon';
import { authFlowApi } from '@/services/api/auth-flow';
import { securityApi } from '@/services/api/security';

interface AuthFactor {
  id: string;
  name: string;
  type: 'mandatory' | 'user-added';
  enabled: boolean;
  available: boolean;
}

interface AuthMethodsModalProps {
  isOpen: boolean;
  onClose: () => void;
  onSave?: (factors: AuthFactor[]) => void;
}

export const AuthMethodsModal: React.FC<AuthMethodsModalProps> = ({
  isOpen,
  onClose,
  onSave
}) => {
  const { t } = useTranslation();
  const [mandatoryFactors, setMandatoryFactors] = useState<AuthFactor[]>([]);
  const [userFactors, setUserFactors] = useState<AuthFactor[]>([]);
  const [availableFactors, setAvailableFactors] = useState<AuthFactor[]>([]);
  const [loading, setLoading] = useState(true);
  
  useEffect(() => {
    if (isOpen) {
      fetchFactors();
    }
  }, [isOpen]);
  
  const fetchFactors = async () => {
    try {
      // –ü–æ–ª—É—á–∏—Ç—å –æ–±—è–∑–∞—Ç–µ–ª—å–Ω—ã–µ —Ñ–∞–∫—Ç–æ—Ä—ã + –∏–Ω–¥–∏–≤–∏–¥—É–∞–ª—å–Ω—ã–µ
      const response = await authFlowApi.getUserFlowSettings();
      const data = response.data?.data;
      
      setMandatoryFactors(data?.mandatory?.factors || []);
      setUserFactors(data?.user?.additionalFactors || []);
      
      // –ü–æ–ª—É—á–∏—Ç—å –¥–æ—Å—Ç—É–ø–Ω—ã–µ —Ñ–∞–∫—Ç–æ—Ä—ã –¥–ª—è –¥–æ–±–∞–≤–ª–µ–Ω–∏—è
      // TODO: API –¥–ª—è –ø–æ–ª—É—á–µ–Ω–∏—è –¥–æ—Å—Ç—É–ø–Ω—ã—Ö –º–µ—Ç–æ–¥–æ–≤
      setAvailableFactors([
        { id: 'email', name: 'Email', type: 'user-added', enabled: false, available: true },
        { id: 'telegram', name: 'Telegram', type: 'user-added', enabled: false, available: true },
        { id: 'github', name: 'GitHub', type: 'user-added', enabled: false, available: true },
      ]);
    } catch (error) {
      console.error('Failed to fetch factors', error);
    } finally {
      setLoading(false);
    }
  };
  
  const handleAddFactor = async (factorId: string) => {
    try {
      await securityApi.addAdditionalFactor(factorId);
      await fetchFactors();
    } catch (error) {
      console.error('Failed to add factor', error);
    }
  };
  
  const handleRemoveFactor = async (factorId: string) => {
    try {
      await securityApi.removeAdditionalFactor(factorId);
      await fetchFactors();
    } catch (error) {
      console.error('Failed to remove factor', error);
    }
  };
  
  return (
    <Modal isOpen={isOpen} onClose={onClose} title={t('security.authMethods.title', '–°–ø–æ—Å–æ–±—ã –≤—Ö–æ–¥–∞')}>
      {loading ? (
        <div>Loading...</div>
      ) : (
        <div className="space-y-6">
          {/* –û–±—è–∑–∞—Ç–µ–ª—å–Ω—ã–µ —Ñ–∞–∫—Ç–æ—Ä—ã */}
          <div>
            <h3 className="font-medium mb-2">
              {t('security.authMethods.mandatory', '–û–±—è–∑–∞—Ç–µ–ª—å–Ω—ã–µ —Ñ–∞–∫—Ç–æ—Ä—ã')}
            </h3>
            <p className="text-sm text-gray-500 mb-4">
              {t('security.authMethods.mandatoryDescription', '–£—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω—ã –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä–æ–º –¥–ª—è –≤—Å–µ—Ö –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π')}
            </p>
            <div className="space-y-2">
              {mandatoryFactors.map((factor) => (
                <div key={factor.id} className="flex items-center justify-between p-3 border rounded">
                  <div className="flex items-center gap-3">
                    <Icon name="shield" size="md" />
                    <span>{factor.name}</span>
                  </div>
                  <span className="text-sm text-gray-500">
                    {t('security.authMethods.required', '–û–±—è–∑–∞—Ç–µ–ª—å–Ω–æ')}
                  </span>
                </div>
              ))}
            </div>
          </div>
          
          {/* –î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã–µ —Ñ–∞–∫—Ç–æ—Ä—ã */}
          <div>
            <h3 className="font-medium mb-2">
              {t('security.authMethods.additional', '–î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã–µ —Ñ–∞–∫—Ç–æ—Ä—ã')}
            </h3>
            <p className="text-sm text-gray-500 mb-4">
              {t('security.authMethods.additionalDescription', '–í—ã –º–æ–∂–µ—Ç–µ –¥–æ–±–∞–≤–∏—Ç—å –¥–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã–µ —Å–ø–æ—Å–æ–±—ã –∑–∞—â–∏—Ç—ã')}
            </p>
            <div className="space-y-2">
              {userFactors.map((factor) => (
                <div key={factor.id} className="flex items-center justify-between p-3 border rounded">
                  <div className="flex items-center gap-3">
                    <Icon name="shield" size="md" />
                    <span>{factor.name}</span>
                  </div>
                  <Button 
                    variant="outline" 
                    size="sm"
                    onClick={() => handleRemoveFactor(factor.id)}
                  >
                    {t('common.remove', '–£–¥–∞–ª–∏—Ç—å')}
                  </Button>
                </div>
              ))}
              
              {/* –î–æ—Å—Ç—É–ø–Ω—ã–µ –¥–ª—è –¥–æ–±–∞–≤–ª–µ–Ω–∏—è */}
              {availableFactors
                .filter(f => !userFactors.some(uf => uf.id === f.id))
                .map((factor) => (
                  <div key={factor.id} className="flex items-center justify-between p-3 border rounded border-dashed">
                    <div className="flex items-center gap-3">
                      <Icon name="plus" size="md" />
                      <span>{factor.name}</span>
                    </div>
                    <Button 
                      variant="outline" 
                      size="sm"
                      onClick={() => handleAddFactor(factor.id)}
                    >
                      {t('common.add', '–î–æ–±–∞–≤–∏—Ç—å')}
                    </Button>
                  </div>
                ))}
            </div>
          </div>
          
          <div className="flex gap-2 justify-end pt-4 border-t">
            <Button variant="outline" onClick={onClose}>
              {t('common.close', '–ó–∞–∫—Ä—ã—Ç—å')}
            </Button>
          </div>
        </div>
      )}
    </Modal>
  );
};
```

**–ó–∞–¥–∞—á–∞ 9.2: –î–æ–±–∞–≤–∏—Ç—å API –º–µ—Ç–æ–¥—ã**
```typescript
// frontend/src/services/api/auth-flow.ts
export const authFlowApi = {
  // ... existing methods
  
  getUserFlowSettings: () => apiClient.get('/auth/user-flow-settings'),
};

// frontend/src/services/api/security.ts
export const securityApi = {
  // ... existing methods
  
  addAdditionalFactor: (method: string) => 
    apiClient.post('/auth/user-additional-factors', { method }),
  
  removeAdditionalFactor: (method: string) => 
    apiClient.delete(`/auth/user-additional-factors/${method}`),
};
```

---

### –≠–¢–ê–ü 3: –ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è Auth Flow –≤ —Ñ–æ—Ä–º—ã –≤—Ö–æ–¥–∞/—Ä–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏–∏ (2-3 –¥–Ω—è)

#### –î–µ–Ω—å 10-11: –î–∏–Ω–∞–º–∏—á–µ—Å–∫–∞—è —Ñ–æ—Ä–º–∞ –≤—Ö–æ–¥–∞

**–ó–∞–¥–∞—á–∞ 10.1: –û–±–Ω–æ–≤–∏—Ç—å —Å—Ç—Ä–∞–Ω–∏—Ü—É –≤—Ö–æ–¥–∞**
```typescript
// frontend/src/pages/auth/LoginPage.tsx
import React, { useState, useEffect } from 'react';
import { useTranslation } from 'react-i18next';
import { authFlowApi } from '@/services/api/auth-flow';
import { authApi } from '@/services/api/auth';

const LoginPage: React.FC = () => {
  const { t } = useTranslation();
  const [flowConfig, setFlowConfig] = useState<any>(null);
  const [currentStep, setCurrentStep] = useState(0);
  const [formData, setFormData] = useState<any>({});
  
  useEffect(() => {
    // –ó–∞–≥—Ä—É–∑–∏—Ç—å –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—é Auth Flow
    const fetchFlow = async () => {
      const response = await authFlowApi.getPublicAuthFlow();
      const config = response.data?.data;
      setFlowConfig(config);
    };
    
    fetchFlow();
  }, []);
  
  const currentMethod = flowConfig?.login?.[currentStep];
  
  const handleSubmit = async () => {
    // –õ–æ–≥–∏–∫–∞ –≤ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏ –æ—Ç —Ç–µ–∫—É—â–µ–≥–æ —à–∞–≥–∞
    if (currentMethod.id === 'phone-email') {
      // –û—Ç–ø—Ä–∞–≤–∏—Ç—å –ª–æ–≥–∏–Ω (email –∏–ª–∏ —Ç–µ–ª–µ—Ñ–æ–Ω)
      // –ü–µ—Ä–µ–π—Ç–∏ –∫ —Å–ª–µ–¥—É—é—â–µ–º—É —à–∞–≥—É
      setCurrentStep(currentStep + 1);
    } else if (currentMethod.id === 'password') {
      // –û—Ç–ø—Ä–∞–≤–∏—Ç—å –ø–∞—Ä–æ–ª—å
      // –í—ã–ø–æ–ª–Ω–∏—Ç—å –≤—Ö–æ–¥
      await authApi.login(formData);
    }
    // –ò —Ç.–¥. –¥–ª—è –¥—Ä—É–≥–∏—Ö –º–µ—Ç–æ–¥–æ–≤
  };
  
  return (
    <div>
      <h1>{t('auth.login', '–í—Ö–æ–¥')}</h1>
      {currentMethod && (
        <div>
          {/* –î–∏–Ω–∞–º–∏—á–µ—Å–∫–∏ —Ä–µ–Ω–¥–µ—Ä–∏–º –ø–æ–ª—è –≤ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏ –æ—Ç currentMethod.id */}
          {currentMethod.id === 'phone-email' && (
            <input 
              type="text" 
              placeholder={t('auth.phoneOrEmail', '–¢–µ–ª–µ—Ñ–æ–Ω –∏–ª–∏ Email')}
              onChange={(e) => setFormData({ ...formData, login: e.target.value })}
            />
          )}
          {currentMethod.id === 'password' && (
            <input 
              type="password" 
              placeholder={t('auth.password', '–ü–∞—Ä–æ–ª—å')}
              onChange={(e) => setFormData({ ...formData, password: e.target.value })}
            />
          )}
          {/* –î—Ä—É–≥–∏–µ –º–µ—Ç–æ–¥—ã... */}
          
          <button onClick={handleSubmit}>
            {t('common.continue', '–ü—Ä–æ–¥–æ–ª–∂–∏—Ç—å')}
          </button>
        </div>
      )}
    </div>
  );
};

export default LoginPage;
```

**–ó–∞–¥–∞—á–∞ 10.2: –ê–Ω–∞–ª–æ–≥–∏—á–Ω–æ –¥–ª—è —Ä–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏–∏**
- –û–±–Ω–æ–≤–∏—Ç—å `RegistrationPage` –¥–ª—è –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è `flowConfig.registration`
- –î–∏–Ω–∞–º–∏—á–µ—Å–∫–∏ –¥–æ–±–∞–≤–ª—è—Ç—å –ø–æ–ª—è –≤ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏ –æ—Ç –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–∏

#### –î–µ–Ω—å 12: –ö–Ω–æ–ø–∫–∞ "–í—ã–π—Ç–∏ –≤–µ–∑–¥–µ"

**–ó–∞–¥–∞—á–∞ 12.1: –î–æ–±–∞–≤–∏—Ç—å –º–æ–¥–∞–ª–∫—É –ø–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏—è**
```typescript
// frontend/src/pages/SecurityPage.tsx
import { ConfirmationModal } from '@/components/Modals/ConfirmationModal';

const SecurityPage: React.FC = () => {
  // ... existing code
  
  const logoutAllModal = useModal();
  const [isLoggingOut, setIsLoggingOut] = useState(false);
  
  const handleLogoutAll = async () => {
    setIsLoggingOut(true);
    
    try {
      await securityApi.logoutFromAllDevices(false); // –ù–µ —Å–æ—Ö—Ä–∞–Ω—è—Ç—å —Ç–µ–∫—É—â—É—é —Å–µ—Å—Å–∏—é
      // –ü–µ—Ä–µ–Ω–∞–ø—Ä–∞–≤–∏—Ç—å –Ω–∞ —Å—Ç—Ä–∞–Ω–∏—Ü—É –≤—Ö–æ–¥–∞
      window.location.href = '/login';
    } catch (error) {
      console.error('Failed to logout from all devices', error);
    } finally {
      setIsLoggingOut(false);
    }
  };
  
  return (
    <>
      {/* ... existing content */}
      
      <Button 
        variant="outline" 
        fullWidth
        className={themeClasses.button.error}
        leftIcon={<Icon name="logout" size="sm" />}
        rightIcon={<Icon name="chevron-right" size="sm" />}
        onClick={logoutAllModal.open}
      >
        {t('security.control.logoutAll', '–í—ã–π—Ç–∏ –≤–µ–∑–¥–µ')}
      </Button>
      
      {/* –ú–æ–¥–∞–ª–∫–∞ –ø–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏—è */}
      {logoutAllModal.isOpen && (
        <ConfirmationModal
          isOpen={logoutAllModal.isOpen}
          onClose={logoutAllModal.close}
          onConfirm={handleLogoutAll}
          title={t('security.logoutAll.title', '–í—ã–π—Ç–∏ –≤–µ–∑–¥–µ?')}
          description={t('security.logoutAll.description', '–í—ã –±—É–¥–µ—Ç–µ —Ä–∞–∑–ª–æ–≥–∏–Ω–µ–Ω—ã –Ω–∞ –≤—Å–µ—Ö —É—Å—Ç—Ä–æ–π—Å—Ç–≤–∞—Ö, –≤–∫–ª—é—á–∞—è —ç—Ç–æ')}
          confirmText={t('security.logoutAll.confirm', '–í—ã–π—Ç–∏ –≤–µ–∑–¥–µ')}
          cancelText={t('common.cancel', '–û—Ç–º–µ–Ω–∞')}
          isLoading={isLoggingOut}
        />
      )}
    </>
  );
};
```

---

### –≠–¢–ê–ü 4: –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ –∏ –ø–æ–ª–∏—Ä–æ–≤–∫–∞ (2-3 –¥–Ω—è)

#### –î–µ–Ω—å 13-14: –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ

1. **Backend —Ç–µ—Å—Ç—ã:**
   - Unit —Ç–µ—Å—Ç—ã –¥–ª—è –≤—Å–µ—Ö –Ω–æ–≤—ã—Ö –º–µ—Ç–æ–¥–æ–≤
   - Integration —Ç–µ—Å—Ç—ã –¥–ª—è endpoints
   - –¢–µ—Å—Ç—ã –¥–ª—è Auth Flow –ª–æ–≥–∏–∫–∏

2. **Frontend —Ç–µ—Å—Ç—ã:**
   - –¢–µ—Å—Ç—ã –¥–ª—è –Ω–æ–≤—ã—Ö –∫–æ–º–ø–æ–Ω–µ–Ω—Ç–æ–≤
   - E2E —Ç–µ—Å—Ç—ã –¥–ª—è –∫—Ä–∏—Ç–∏—á–µ—Å–∫–∏—Ö –ø—É—Ç–µ–π (–≤—Ö–æ–¥, –≤—ã—Ö–æ–¥, —Å–º–µ–Ω–∞ –ø–∞—Ä–æ–ª—è)

3. **–†—É—á–Ω–æ–µ —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ:**
   - –ü—Ä–æ–≤–µ—Ä–∏—Ç—å –≤—Å–µ —Ñ—É–Ω–∫—Ü–∏–∏ –≤ —Ä–µ–∞–ª—å–Ω—ã—Ö –±—Ä–∞—É–∑–µ—Ä–∞—Ö
   - –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ –º–æ–±–∏–ª—å–Ω–æ–π –≤–µ—Ä—Å–∏–∏
   - –ü—Ä–æ–≤–µ—Ä–∫–∞ i18n (–ø–µ—Ä–µ–≤–æ–¥—ã)

#### –î–µ–Ω—å 15: –î–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è –∏ –¥–µ–ø–ª–æ–π

1. **–î–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è:**
   - –û–±–Ω–æ–≤–∏—Ç—å README
   - –î–æ–±–∞–≤–∏—Ç—å –ø—Ä–∏–º–µ—Ä—ã –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è API
   - –°–æ–∑–¥–∞—Ç—å —Ä—É–∫–æ–≤–æ–¥—Å—Ç–≤–æ –¥–ª—è –∞–¥–º–∏–Ω–æ–≤

2. **–î–µ–ø–ª–æ–π:**
   - –ú–∏–≥—Ä–∞—Ü–∏—è –ë–î (–µ—Å–ª–∏ –µ—Å—Ç—å –Ω–æ–≤—ã–µ –ø–æ–ª—è)
   - –î–µ–ø–ª–æ–π –±—ç–∫–µ–Ω–¥–∞
   - –î–µ–ø–ª–æ–π —Ñ—Ä–æ–Ω—Ç–µ–Ω–¥–∞
   - –ü—Ä–æ–≤–µ—Ä–∫–∞ –≤ production

---

## üì¶ –°—Ç—Ä—É–∫—Ç—É—Ä–∞ –ø—Ä–æ–µ–∫—Ç–∞ (–ø–æ—Å–ª–µ —Ä–µ–∞–ª–∏–∑–∞—Ü–∏–∏)

### Backend:
```
backend/src/
‚îú‚îÄ‚îÄ auth/
‚îÇ   ‚îú‚îÄ‚îÄ entities/
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ refresh-token.entity.ts (–æ–±–Ω–æ–≤–ª–µ–Ω–æ)
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ two-factor-code.entity.ts
‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ device-session.entity.ts (–Ω–æ–≤–∞—è, –æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ)
‚îÇ   ‚îú‚îÄ‚îÄ services/
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ nfa.service.ts (—É–∂–µ –µ—Å—Ç—å)
‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ auth-flow.service.ts (–Ω–æ–≤—ã–π, –æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ)
‚îÇ   ‚îú‚îÄ‚îÄ auth.controller.ts (–æ–±–Ω–æ–≤–ª–µ–Ω–æ)
‚îÇ   ‚îî‚îÄ‚îÄ auth.service.ts (–æ–±–Ω–æ–≤–ª–µ–Ω–æ)
‚îú‚îÄ‚îÄ security/
‚îÇ   ‚îú‚îÄ‚îÄ security.controller.ts (–æ–±–Ω–æ–≤–ª–µ–Ω–æ)
‚îÇ   ‚îî‚îÄ‚îÄ security.service.ts (–æ–±–Ω–æ–≤–ª–µ–Ω–æ)
‚îî‚îÄ‚îÄ admin/
    ‚îî‚îÄ‚îÄ admin.controller.ts (–æ–±–Ω–æ–≤–ª–µ–Ω–æ)
```

### Frontend:
```
frontend/src/
‚îú‚îÄ‚îÄ pages/
‚îÇ   ‚îú‚îÄ‚îÄ admin/
‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ AuthFlowBuilderPage.tsx (—É–∂–µ –µ—Å—Ç—å)
‚îÇ   ‚îú‚îÄ‚îÄ SecurityPage.tsx (—É–∂–µ –µ—Å—Ç—å)
‚îÇ   ‚îú‚îÄ‚îÄ SecurityRecoveryMethodsPage.tsx (–Ω–æ–≤–∞—è)
‚îÇ   ‚îú‚îÄ‚îÄ SecurityActivityPage.tsx (–Ω–æ–≤–∞—è)
‚îÇ   ‚îú‚îÄ‚îÄ SecurityDevicesPage.tsx (–Ω–æ–≤–∞—è)
‚îÇ   ‚îî‚îÄ‚îÄ auth/
‚îÇ       ‚îú‚îÄ‚îÄ LoginPage.tsx (–æ–±–Ω–æ–≤–ª–µ–Ω–æ)
‚îÇ       ‚îî‚îÄ‚îÄ RegisterPage.tsx (–æ–±–Ω–æ–≤–ª–µ–Ω–æ)
‚îú‚îÄ‚îÄ components/
‚îÇ   ‚îî‚îÄ‚îÄ Modals/
‚îÇ       ‚îú‚îÄ‚îÄ ChangePasswordModal.tsx (–Ω–æ–≤–∞—è)
‚îÇ       ‚îú‚îÄ‚îÄ AuthMethodsModal.tsx (–æ–±–Ω–æ–≤–ª–µ–Ω–æ)
‚îÇ       ‚îî‚îÄ‚îÄ ConfirmationModal.tsx (–Ω–æ–≤–∞—è)
‚îî‚îÄ‚îÄ services/
    ‚îî‚îÄ‚îÄ api/
        ‚îú‚îÄ‚îÄ auth-flow.ts (–æ–±–Ω–æ–≤–ª–µ–Ω–æ)
        ‚îî‚îÄ‚îÄ security.ts (–æ–±–Ω–æ–≤–ª–µ–Ω–æ)
```

---

## üéØ KPI –∏ –º–µ—Ç—Ä–∏–∫–∏ —É—Å–ø–µ—Ö–∞

### –§—É–Ω–∫—Ü–∏–æ–Ω–∞–ª—å–Ω—ã–µ —Ç—Ä–µ–±–æ–≤–∞–Ω–∏—è:
- ‚úÖ –ê–¥–º–∏–Ω –º–æ–∂–µ—Ç –Ω–∞—Å—Ç—Ä–æ–∏—Ç—å –∞–ª–≥–æ—Ä–∏—Ç–º –≤—Ö–æ–¥–∞ (login, registration, factors)
- ‚úÖ –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –≤–∏–¥–∏—Ç –æ–±—è–∑–∞—Ç–µ–ª—å–Ω—ã–µ —Ñ–∞–∫—Ç–æ—Ä—ã + –º–æ–∂–µ—Ç –¥–æ–±–∞–≤–∏—Ç—å –¥–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã–µ
- ‚úÖ –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –º–æ–∂–µ—Ç —Å–º–µ–Ω–∏—Ç—å –ø–∞—Ä–æ–ª—å
- ‚úÖ –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –≤–∏–¥–∏—Ç —Å–ø–∏—Å–æ–∫ —É—Å—Ç—Ä–æ–π—Å—Ç–≤ –∏ –º–æ–∂–µ—Ç —É–¥–∞–ª–∏—Ç—å
- ‚úÖ –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –≤–∏–¥–∏—Ç –∏—Å—Ç–æ—Ä–∏—é –∞–∫—Ç–∏–≤–Ω–æ—Å—Ç–∏
- ‚úÖ –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –º–æ–∂–µ—Ç –≤—ã–π—Ç–∏ —Å–æ –≤—Å–µ—Ö —É—Å—Ç—Ä–æ–π—Å—Ç–≤
- ‚úÖ –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –≤–∏–¥–∏—Ç —Å–ø–æ—Å–æ–±—ã –≤–æ—Å—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∏—è –¥–æ—Å—Ç—É–ø–∞

### –ù–µ—Ñ—É–Ω–∫—Ü–∏–æ–Ω–∞–ª—å–Ω—ã–µ —Ç—Ä–µ–±–æ–≤–∞–Ω–∏—è:
- –í—Ä–µ–º—è –æ—Ç–≤–µ—Ç–∞ API < 500ms
- –ü–æ–∫—Ä—ã—Ç–∏–µ —Ç–µ—Å—Ç–∞–º–∏ > 80%
- –ü–æ–¥–¥–µ—Ä–∂–∫–∞ 3 —è–∑—ã–∫–æ–≤ (RU, EN, CN)
- –ú–æ–±–∏–ª—å–Ω–∞—è –∞–¥–∞–ø—Ç–∞—Ü–∏—è
- Accessibility (WCAG 2.1 AA)

---

## üöÄ –°–ª–µ–¥—É—é—â–∏–µ —à–∞–≥–∏ (–∑–∞ —Ä–∞–º–∫–∞–º–∏ —Å–ø—Ä–∏–Ω—Ç–∞)

1. **–ì–µ–æ–ª–æ–∫–∞—Ü–∏—è** - –æ–ø—Ä–µ–¥–µ–ª–µ–Ω–∏–µ –≥–æ—Ä–æ–¥–∞/—Å—Ç—Ä–∞–Ω—ã –ø–æ IP
2. **Device Fingerprinting** - –±–æ–ª–µ–µ —Ç–æ—á–Ω–∞—è –∏–¥–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏—è —É—Å—Ç—Ä–æ–π—Å—Ç–≤
3. **Email —É–≤–µ–¥–æ–º–ª–µ–Ω–∏—è** - –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏–µ —É–≤–µ–¥–æ–º–ª–µ–Ω–∏—è –æ —Å–æ–±—ã—Ç–∏—è—Ö –±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç–∏
4. **Backup –∫–æ–¥—ã** - —Ä–µ–∑–µ—Ä–≤–Ω—ã–µ –∫–æ–¥—ã –¥–ª—è nFA
5. **Trusted devices** - –¥–æ–≤–µ—Ä–µ–Ω–Ω—ã–µ —É—Å—Ç—Ä–æ–π—Å—Ç–≤–∞ –±–µ–∑ 2FA
6. **OAuth 2.0 Server** - –ø–æ–ª–Ω–æ—Ü–µ–Ω–Ω—ã–π OAuth –ø—Ä–æ–≤–∞–π–¥–µ—Ä –¥–ª—è –≤–Ω–µ—à–Ω–∏—Ö –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–π
7. **WebAuthn / Passkeys** - –±–∏–æ–º–µ—Ç—Ä–∏—á–µ—Å–∫–∞—è –∞—É—Ç–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏—è

---

## üìö –†–µ—Ñ–µ—Ä–µ–Ω—Å—ã –∏ –≤–¥–æ—Ö–Ω–æ–≤–µ–Ω–∏–µ

- Yandex ID: https://id.yandex.ru/security
- Steam Guard: https://store.steampowered.com/twofactor/manage
- Google Account Security: https://myaccount.google.com/security
- GitHub Security: https://github.com/settings/security

---

## ‚úÖ –ß–µ–∫–ª–∏—Å—Ç –ø–µ—Ä–µ–¥ —Ä–µ–ª–∏–∑–æ–º

### Backend:
- [ ] –í—Å–µ endpoints –ø—Ä–æ—Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω—ã
- [ ] Swagger –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è –æ–±–Ω–æ–≤–ª–µ–Ω–∞
- [ ] –ú–∏–≥—Ä–∞—Ü–∏–∏ –ë–î –ø–æ–¥–≥–æ—Ç–æ–≤–ª–µ–Ω—ã
- [ ] Environment variables –Ω–∞—Å—Ç—Ä–æ–µ–Ω—ã
- [ ] Rate limiting –Ω–∞—Å—Ç—Ä–æ–µ–Ω
- [ ] Audit logging —Ä–∞–±–æ—Ç–∞–µ—Ç

### Frontend:
- [ ] –í—Å–µ —Å—Ç—Ä–∞–Ω–∏—Ü—ã —Ä–∞–±–æ—Ç–∞—é—Ç
- [ ] –ü–µ—Ä–µ–≤–æ–¥—ã –¥–æ–±–∞–≤–ª–µ–Ω—ã (RU, EN, CN)
- [ ] –ú–æ–±–∏–ª—å–Ω–∞—è –≤–µ—Ä—Å–∏—è –ø—Ä–æ—Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∞
- [ ] Loading states –¥–æ–±–∞–≤–ª–µ–Ω—ã
- [ ] Error handling —Ä–µ–∞–ª–∏–∑–æ–≤–∞–Ω
- [ ] Accessibility –ø—Ä–æ–≤–µ—Ä–µ–Ω

### DevOps:
- [ ] Docker –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä—ã —Å–æ–±–∏—Ä–∞—é—Ç—Å—è
- [ ] CI/CD –ø–∞–π–ø–ª–∞–π–Ω —Ä–∞–±–æ—Ç–∞–µ—Ç
- [ ] Production secrets –Ω–∞—Å—Ç—Ä–æ–µ–Ω—ã
- [ ] Backup —Å—Ç—Ä–∞—Ç–µ–≥–∏—è –æ–ø—Ä–µ–¥–µ–ª–µ–Ω–∞
- [ ] Monitoring –Ω–∞—Å—Ç—Ä–æ–µ–Ω (Sentry, LogRocket)

---

## üéâ –ó–∞–∫–ª—é—á–µ–Ω–∏–µ

–î–∞–Ω–Ω—ã–π roadmap –ø–æ–∫—Ä—ã–≤–∞–µ—Ç –≤—Å–µ —Ç—Ä–µ–±–æ–≤–∞–Ω–∏—è –∏–∑ —Ç–µ—Ö–Ω–∏—á–µ—Å–∫–æ–≥–æ –∑–∞–¥–∞–Ω–∏—è –∏ –æ–±–µ—Å–ø–µ—á–∏–≤–∞–µ—Ç –ø–æ—à–∞–≥–æ–≤—É—é —Ä–µ–∞–ª–∏–∑–∞—Ü–∏—é —Å–∏—Å—Ç–µ–º—ã –∞—É—Ç–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏–∏ –∏ –±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç–∏. –û—Ü–µ–Ω–∫–∞ –≤—Ä–µ–º–µ–Ω–∏: **15 —Ä–∞–±–æ—á–∏—Ö –¥–Ω–µ–π** –¥–ª—è –ø–æ–ª–Ω–æ–π —Ä–µ–∞–ª–∏–∑–∞—Ü–∏–∏.

**–ü—Ä–∏–æ—Ä–∏—Ç–µ—Ç—ã:**
1. üî¥ –ö—Ä–∏—Ç–∏—á–Ω—ã–µ - –î–µ–Ω—å 1-4 (Backend API)
2. üî¥ –ö—Ä–∏—Ç–∏—á–Ω—ã–µ - –î–µ–Ω—å 5-9 (Frontend —Å—Ç—Ä–∞–Ω–∏—Ü—ã –∏ –º–æ–¥–∞–ª–∫–∏)
3. üü° –°—Ä–µ–¥–Ω–∏–µ - –î–µ–Ω—å 10-12 (–ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è Auth Flow)
4. üü¢ –ü–æ–ª–∏—Ä–æ–≤–∫–∞ - –î–µ–Ω—å 13-15 (–¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ –∏ –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è)

**–ö–æ–º–∞–Ω–¥–∞:**
- 1 Backend —Ä–∞–∑—Ä–∞–±–æ—Ç—á–∏–∫
- 1 Frontend —Ä–∞–∑—Ä–∞–±–æ—Ç—á–∏–∫
- 1 QA –∏–Ω–∂–µ–Ω–µ—Ä (—Å 13 –¥–Ω—è)

–£—Å–ø–µ—Ö–æ–≤ –≤ —Ä–µ–∞–ª–∏–∑–∞—Ü–∏–∏! üöÄ

