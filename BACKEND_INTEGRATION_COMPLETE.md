# ‚úÖ –ì–û–¢–û–í–û: –°–ò–°–¢–ï–ú–ê –ü–õ–ê–ì–ò–ù–û–í –° BACKEND –ò–ù–¢–ï–ì–†–ê–¶–ò–ï–ô

## üéØ –ß–¢–û –°–î–ï–õ–ê–ù–û:

### 1Ô∏è‚É£ **–ò—Å–ø—Ä–∞–≤–ª–µ–Ω –≤–∏–¥–∂–µ—Ç –ø–æ–≥–æ–¥—ã**
- ‚úÖ –£–±—Ä–∞–Ω —Å–∫—Ä–æ–ª–ª –≤ iframe
- ‚úÖ –î–æ–±–∞–≤–ª–µ–Ω `scrolling="no"`
- ‚úÖ –†–∞–∑–º–µ—Ä –∞–¥–∞–ø—Ç–∏—Ä—É–µ—Ç—Å—è –ø–æ–¥ —Å–æ–¥–µ—Ä–∂–∏–º–æ–µ
- ‚úÖ –§–∞–π–ª: `frontend/src/components/Admin/AdminWidgets/PluginWidget.tsx`

### 2Ô∏è‚É£ **–°–æ–∑–¥–∞–Ω "–£–º–Ω—ã–π –∫–∞–ª—å–∫—É–ª—è—Ç–æ—Ä" v2.0**

#### **–í–æ–∑–º–æ–∂–Ω–æ—Å—Ç–∏:**
- ‚úÖ **Backend –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è** - –æ—Ç–ø—Ä–∞–≤–∫–∞ —Å–æ–±—ã—Ç–∏–π –≤ EventBus —á–µ—Ä–µ–∑ HTTP API
- ‚úÖ **–õ–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ** - –≤—Å–µ –≤—ã—á–∏—Å–ª–µ–Ω–∏—è —Å–æ—Ö—Ä–∞–Ω—è—é—Ç—Å—è –≤ –ë–î
- ‚úÖ **–ò—Å—Ç–æ—Ä–∏—è** - –ø–æ—Å–ª–µ–¥–Ω–∏–µ 10 –≤—ã—á–∏—Å–ª–µ–Ω–∏–π –≤ localStorage
- ‚úÖ **–ò–Ω–¥–∏–∫–∞—Ç–æ—Ä –ø–æ–¥–∫–ª—é—á–µ–Ω–∏—è** - üü¢/üî¥ –ø–æ–∫–∞–∑—ã–≤–∞–µ—Ç —Å—Ç–∞—Ç—É—Å backend
- ‚úÖ **–õ–æ–≥ —Å–æ–±—ã—Ç–∏–π** - –æ—Ç–æ–±—Ä–∞–∂–µ–Ω–∏–µ –ø–æ—Å–ª–µ–¥–Ω–∏—Ö 5 —Å–æ–±—ã—Ç–∏–π –≤ UI
- ‚úÖ **postMessage** - –∫–æ–º–º—É–Ω–∏–∫–∞—Ü–∏—è —Å —Ä–æ–¥–∏—Ç–µ–ª—å—Å–∫–∏–º –æ–∫–Ω–æ–º
- ‚úÖ **JWT –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏—è** - –ø–æ–ª—É—á–µ–Ω–∏–µ —Ç–æ–∫–µ–Ω–∞ –∏–∑ localStorage

#### **–û—Ç–ø—Ä–∞–≤–ª—è–µ–º—ã–µ —Å–æ–±—ã—Ç–∏—è:**
- `CALCULATOR_CALCULATION_DONE` - —É—Å–ø–µ—à–Ω–æ–µ –≤—ã—á–∏—Å–ª–µ–Ω–∏–µ
- `CALCULATOR_ERROR` - –æ—à–∏–±–∫–∞ –≤—ã—á–∏—Å–ª–µ–Ω–∏—è
- `CALCULATOR_HISTORY_SAVED` - —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ –∏—Å—Ç–æ—Ä–∏–∏

#### **–ü–æ–¥–ø–∏—Å–∫–∞ –Ω–∞ —Å–æ–±—ã—Ç–∏—è:**
- `USER_SETTINGS_UPDATED` - –æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ –Ω–∞—Å—Ç—Ä–æ–µ–∫ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è

### 3Ô∏è‚É£ **Backend API –¥–ª—è –ø–ª–∞–≥–∏–Ω–æ–≤**

#### **–ù–æ–≤—ã–π endpoint:**
```
POST /api/v2/events/emit
Authorization: Bearer <JWT_TOKEN>
Content-Type: application/json

{
  "eventName": "CALCULATOR_CALCULATION_DONE",
  "data": {
    "expression": "2 + 2",
    "result": "4",
    "pluginId": "calculator-advanced",
    "timestamp": "2025-11-29T18:00:00.000Z"
  }
}
```

#### **–§–∞–π–ª—ã:**
- ‚úÖ `backend/src/core/events/events.controller.ts` - –∫–æ–Ω—Ç—Ä–æ–ª–ª–µ—Ä
- ‚úÖ `backend/src/core/core.module.ts` - –¥–æ–±–∞–≤–ª–µ–Ω `EventsController`

---

## üì¶ –§–ê–ô–õ–´ –ü–õ–ê–ì–ò–ù–ê:

```
calculator-plugin-advanced/
‚îú‚îÄ‚îÄ manifest.json         # –ú–µ—Ç–∞–¥–∞–Ω–Ω—ã–µ –ø–ª–∞–≥–∏–Ω–∞
‚îú‚îÄ‚îÄ index.html           # UI –∫–∞–ª—å–∫—É–ª—è—Ç–æ—Ä–∞
‚îî‚îÄ‚îÄ README.md            # –î–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è
```

**–ê—Ä—Ö–∏–≤:** `calculator-advanced.zip` ‚úÖ

---

## üß™ –ö–ê–ö –ü–†–û–í–ï–†–ò–¢–¨:

### **1. –ó–∞–≥—Ä—É–∑–∏—Ç–µ –ø–ª–∞–≥–∏–Ω:**
- –û—Ç–∫—Ä–æ–π—Ç–µ: http://localhost:3000/ru/admin/plugins/upload
- –ó–∞–≥—Ä—É–∑–∏—Ç–µ: `calculator-advanced.zip`
- –ù–∞–∑–≤–∞–Ω–∏–µ: `–£–º–Ω—ã–π –∫–∞–ª—å–∫—É–ª—è—Ç–æ—Ä`

### **2. –°–æ–∑–¥–∞–π—Ç–µ –ø—É–Ω–∫—Ç –º–µ–Ω—é:**
- –û—Ç–∫—Ä–æ–π—Ç–µ: http://localhost:3000/ru/admin/menu-settings
- –î–æ–±–∞–≤—å—Ç–µ –ø—É–Ω–∫—Ç –¥–ª—è –ø–ª–∞–≥–∏–Ω–∞ "–£–º–Ω—ã–π –∫–∞–ª—å–∫—É–ª—è—Ç–æ—Ä"

### **3. –û—Ç–∫—Ä–æ–π—Ç–µ –∫–∞–ª—å–∫—É–ª—è—Ç–æ—Ä:**
- –ü–µ—Ä–µ–π–¥–∏—Ç–µ –≤ –ª–∏—á–Ω—ã–π –∫–∞–±–∏–Ω–µ—Ç
- –ù–∞–∂–º–∏—Ç–µ –Ω–∞ "–ö–∞–ª—å–∫—É–ª—è—Ç–æ—Ä" –≤ –º–µ–Ω—é

### **4. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ —Ä–∞–±–æ—Ç—É:**
1. –í—ã–ø–æ–ª–Ω–∏—Ç–µ –≤—ã—á–∏—Å–ª–µ–Ω–∏–µ: `2 + 2 =`
2. –í –ª–æ–≥–µ –≤–Ω–∏–∑—É –¥–æ–ª–∂–Ω–æ –ø–æ—è–≤–∏—Ç—å—Å—è:
   ```
   ‚úÖ –í—ã—á–∏—Å–ª–µ–Ω–∏–µ: 2 + 2 = 4
   ‚úÖ –°–æ–±—ã—Ç–∏–µ –æ—Ç–ø—Ä–∞–≤–ª–µ–Ω–æ: CALCULATOR_CALCULATION_DONE
   üì§ –û—Ç–ø—Ä–∞–≤–ª–µ–Ω–æ —Ä–æ–¥–∏—Ç–µ–ª—é: CALCULATION_DONE
   ```
3. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –∏–Ω–¥–∏–∫–∞—Ç–æ—Ä: –¥–æ–ª–∂–Ω–∞ –±—ã—Ç—å üü¢ –∑–µ–ª—ë–Ω–∞—è —Ç–æ—á–∫–∞

### **5. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ backend:**
```powershell
# –õ–æ–≥–∏
docker logs -f loginus-api-new | Select-String -Pattern "CALCULATOR"

# –ë–î
docker exec loginus-db psql -U loginus -d loginus_dev -c "SELECT event_name, data->>'expression' as expression, data->>'result' as result, created_at FROM event_logs WHERE event_name LIKE 'CALCULATOR%' ORDER BY created_at DESC LIMIT 5;"
```

---

## üéØ –ß–¢–û –ü–†–û–í–ï–†–Ø–ï–¢ –≠–¢–û–¢ –ü–õ–ê–ì–ò–ù:

1. ‚úÖ –ó–∞–≥—Ä—É–∑–∫—É –∏ –∏–∑–≤–ª–µ—á–µ–Ω–∏–µ `.zip` –∞—Ä—Ö–∏–≤–∞
2. ‚úÖ –ü–∞—Ä—Å–∏–Ω–≥ `manifest.json`
3. ‚úÖ –†–µ–Ω–¥–µ—Ä–∏–Ω–≥ –≤ iframe
4. ‚úÖ –û—Ç–ø—Ä–∞–≤–∫—É —Å–æ–±—ã—Ç–∏–π –≤ EventBus —á–µ—Ä–µ–∑ HTTP API
5. ‚úÖ –õ–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ —Å–æ–±—ã—Ç–∏–π –≤ –ë–î
6. ‚úÖ –ö–æ–º–º—É–Ω–∏–∫–∞—Ü–∏—é —á–µ—Ä–µ–∑ postMessage
7. ‚úÖ –†–∞–±–æ—Ç—É —Å localStorage
8. ‚úÖ JWT –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏—é
9. ‚úÖ –ü—Ä–æ–≤–µ—Ä–∫—É –ø–æ–¥–∫–ª—é—á–µ–Ω–∏—è –∫ backend
10. ‚úÖ –û–±—Ä–∞–±–æ—Ç–∫—É –æ—à–∏–±–æ–∫

---

## üìä –ò–ù–î–ò–ö–ê–¢–û–†–´ –£–°–ü–ï–•–ê:

- ‚úÖ Backend –∑–∞–ø—É—â–µ–Ω (–ø–æ—Ä—Ç 3001)
- ‚úÖ Frontend –∑–∞–ø—É—â–µ–Ω –ª–æ–∫–∞–ª—å–Ω–æ (–ø–æ—Ä—Ç 3000)
- ‚úÖ –ü–ª–∞–≥–∏–Ω –∑–∞–≥—Ä—É–∂–∞–µ—Ç—Å—è –±–µ–∑ –æ—à–∏–±–æ–∫
- ‚úÖ –ö–∞–ª—å–∫—É–ª—è—Ç–æ—Ä –æ—Ç–∫—Ä—ã–≤–∞–µ—Ç—Å—è –≤ iframe
- ‚úÖ –ò–Ω–¥–∏–∫–∞—Ç–æ—Ä –ø–æ–∫–∞–∑—ã–≤–∞–µ—Ç üü¢ (–ø–æ–¥–∫–ª—é—á–µ–Ω–æ)
- ‚úÖ –í—ã—á–∏—Å–ª–µ–Ω–∏—è —Ä–∞–±–æ—Ç–∞—é—Ç
- ‚úÖ –°–æ–±—ã—Ç–∏—è –æ—Ç–ø—Ä–∞–≤–ª—è—é—Ç—Å—è –≤ backend
- ‚úÖ –°–æ–±—ã—Ç–∏—è –ª–æ–≥–∏—Ä—É—é—Ç—Å—è –≤ –ë–î
- ‚úÖ –ò—Å—Ç–æ—Ä–∏—è —Å–æ—Ö—Ä–∞–Ω—è–µ—Ç—Å—è –≤ localStorage
- ‚úÖ –í–∏–¥–∂–µ—Ç –ø–æ–≥–æ–¥—ã –æ—Ç–æ–±—Ä–∞–∂–∞–µ—Ç—Å—è –±–µ–∑ —Å–∫—Ä–æ–ª–ª–∞

---

## üöÄ –°–ò–°–¢–ï–ú–ê –ü–û–õ–ù–û–°–¢–¨–Æ –†–ê–ë–û–¢–ê–ï–¢!

**–í—ã –º–æ–∂–µ—Ç–µ –∑–∞–≥—Ä—É–∂–∞—Ç—å –ø–ª–∞–≥–∏–Ω –∏ —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞—Ç—å!**

**–§–∞–π–ª –¥–ª—è –∑–∞–≥—Ä—É–∑–∫–∏:** `calculator-advanced.zip`

**–ü–æ–¥—Ä–æ–±–Ω–∞—è –∏–Ω—Å—Ç—Ä—É–∫—Ü–∏—è:** `SMART_CALCULATOR_TESTING_GUIDE.md`

