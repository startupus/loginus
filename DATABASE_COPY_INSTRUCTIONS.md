# üì¶ –ò–Ω—Å—Ç—Ä—É–∫—Ü–∏—è –ø–æ –∫–æ–ø–∏—Ä–æ–≤–∞–Ω–∏—é –ª–æ–∫–∞–ª—å–Ω–æ–π –ë–î –Ω–∞ —Å–µ—Ä–≤–µ—Ä

## ‚úÖ –ß—Ç–æ —É–∂–µ —Å–¥–µ–ª–∞–Ω–æ:

1. **Nginx –ø—Ä–æ–∫—Å–∏ –∏—Å–ø—Ä–∞–≤–ª–µ–Ω** - –¥–æ–±–∞–≤–ª–µ–Ω –ø—Ä–∞–≤–∏–ª—å–Ω—ã–π –ø—É—Ç—å `/api` –≤ `proxy_pass`
2. **–°–æ–∑–¥–∞–Ω—ã —Å–∫—Ä–∏–ø—Ç—ã** –¥–ª—è –∫–æ–ø–∏—Ä–æ–≤–∞–Ω–∏—è –∏ –≤–æ—Å—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∏—è –ë–î
3. **–î–∞–º–ø —Å–æ–∑–¥–∞–Ω** –∏ —Å–∫–æ–ø–∏—Ä–æ–≤–∞–Ω –Ω–∞ —Å–µ—Ä–≤–µ—Ä: `/tmp/loginus_db_dump.dump`

## üîß –í–æ—Å—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∏–µ –ë–î –Ω–∞ —Å–µ—Ä–≤–µ—Ä–µ:

### –í–∞—Ä–∏–∞–Ω—Ç 1: –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏–π (—Ä–µ–∫–æ–º–µ–Ω–¥—É–µ—Ç—Å—è)

```bash
ssh -i C:\Users\teramisuslik\.ssh\id_ed25519 root@45.144.176.42
cd /root/loginus-new
./restore-database.sh /tmp/loginus_db_dump.dump
```

### –í–∞—Ä–∏–∞–Ω—Ç 2: –í—Ä—É—á–Ω—É—é

```bash
# 1. –ü–æ–¥–∫–ª—é—á–∏—Ç–µ—Å—å –∫ —Å–µ—Ä–≤–µ—Ä—É
ssh -i C:\Users\teramisuslik\.ssh\id_ed25519 root@45.144.176.42

# 2. –û—Å—Ç–∞–Ω–æ–≤–∏—Ç–µ API
cd /root/loginus-new
docker-compose -f docker-compose.prod.yml stop loginus-api

# 3. –í–æ—Å—Å—Ç–∞–Ω–æ–≤–∏—Ç–µ –ë–î
docker exec -i loginus-db-prod pg_restore -U loginus -d loginus_prod -c --if-exists < /tmp/loginus_db_dump.dump

# 4. –ó–∞–ø—É—Å—Ç–∏—Ç–µ API
docker-compose -f docker-compose.prod.yml start loginus-api
```

## üìù –°–æ–∑–¥–∞–Ω–∏–µ –Ω–æ–≤–æ–≥–æ –¥–∞–º–ø–∞ (–µ—Å–ª–∏ –Ω—É–∂–Ω–æ):

### –ù–∞ Windows (PowerShell):

```powershell
# 1. –°–æ–∑–¥–∞–π—Ç–µ –¥–∞–º–ø –∏–∑ –ª–æ–∫–∞–ª—å–Ω–æ–≥–æ –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–∞
docker exec loginus-db pg_dump -U loginus -d loginus_dev -F c -f /tmp/loginus_dump.dump

# 2. –°–∫–æ–ø–∏—Ä—É–π—Ç–µ –¥–∞–º–ø –∏–∑ –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–∞
docker cp loginus-db:/tmp/loginus_dump.dump .\loginus_db_dump.dump

# 3. –°–∫–æ–ø–∏—Ä—É–π—Ç–µ –Ω–∞ —Å–µ—Ä–≤–µ—Ä
scp -i C:\Users\teramisuslik\.ssh\id_ed25519 loginus_db_dump.dump root@45.144.176.42:/tmp/
```

### –ò–ª–∏ –∏—Å–ø–æ–ª—å–∑—É–π—Ç–µ –≥–æ—Ç–æ–≤—ã–π —Å–∫—Ä–∏–ø—Ç:

```powershell
.\copy-database.ps1
```

## ‚ö†Ô∏è –í–∞–∂–Ω—ã–µ –∑–∞–º–µ—á–∞–Ω–∏—è:

1. **–ü–∞—Ä–æ–ª–∏ –∏ —Å–µ–∫—Ä–µ—Ç—ã**: –ü–æ—Å–ª–µ –≤–æ—Å—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∏—è –ë–î —É–±–µ–¥–∏—Ç–µ—Å—å, —á—Ç–æ –Ω–∞ —Å–µ—Ä–≤–µ—Ä–µ –ø—Ä–∞–≤–∏–ª—å–Ω–æ –Ω–∞—Å—Ç—Ä–æ–µ–Ω—ã:
   - `JWT_SECRET`
   - `JWT_REFRESH_SECRET`
   - `SMTP_*` –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–µ (–µ—Å–ª–∏ –∏—Å–ø–æ–ª—å–∑—É—é—Ç—Å—è)

2. **–ü—Ä–æ–≤–µ—Ä–∫–∞**: –ü–æ—Å–ª–µ –≤–æ—Å—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∏—è –ø—Ä–æ–≤–µ—Ä—å—Ç–µ:
   ```bash
   docker exec loginus-db-prod psql -U loginus -d loginus_prod -c "SELECT COUNT(*) FROM users;"
   ```

3. **–ë—ç–∫–∞–ø**: –ü–µ—Ä–µ–¥ –≤–æ—Å—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∏–µ–º —Ä–µ–∫–æ–º–µ–Ω–¥—É–µ—Ç—Å—è —Å–¥–µ–ª–∞—Ç—å –±—ç–∫–∞–ø —Ç–µ–∫—É—â–µ–π –ë–î –Ω–∞ —Å–µ—Ä–≤–µ—Ä–µ:
   ```bash
   docker exec loginus-db-prod pg_dump -U loginus -d loginus_prod -F c -f /tmp/backup_before_restore.dump
   ```

## üéØ –¢–µ–∫—É—â–∏–π —Å—Ç–∞—Ç—É—Å:

- ‚úÖ –î–∞–º–ø —Å–æ–∑–¥–∞–Ω –∏ —Å–∫–æ–ø–∏—Ä–æ–≤–∞–Ω –Ω–∞ —Å–µ—Ä–≤–µ—Ä
- ‚úÖ Nginx –ø—Ä–æ–∫—Å–∏ –∏—Å–ø—Ä–∞–≤–ª–µ–Ω
- ‚è≥ –ë–î –≥–æ—Ç–æ–≤–∞ –∫ –≤–æ—Å—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∏—é (–≤—ã–ø–æ–ª–Ω–∏—Ç–µ –∫–æ–º–∞–Ω–¥—ã –≤—ã—à–µ)

