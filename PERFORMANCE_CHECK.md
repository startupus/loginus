# Проверка производительности страницы /en/dashboard

## Выполненные оптимизации

1. ✅ **Оптимизация changeLanguage** - загружаются только критичные модули (common, profile, dashboard) вместо всех 15 модулей
2. ✅ **Оптимизация предзагрузки в DashboardPage** - убрано дублирование, загружаются только дополнительные модули (data, modals)
3. ✅ **Оптимизация preloadModule** - убран forceReload, используется кэш, добавлена проверка на уже загруженные модули
4. ✅ **Оптимизация Sidebar** - оптимизированы зависимости useMemo, убраны лишние пересчеты

## Ожидаемые результаты

### При первой загрузке страницы `/en/dashboard`:
- **Критичные модули** (загружаются при инициализации i18n): `common`, `profile`, `dashboard`
- **Дополнительные модули** (загружаются в DashboardPage): `data`, `modals`
- **Всего запросов к API переводов**: 3-5 (в зависимости от наличия кэша)

### При переключении языка:
- Загружаются только критичные модули (3 модуля)
- Остальные модули загружаются по требованию через missingKey handler
- Время переключения: < 500ms

## Инструкции по проверке

### 1. Проверка количества запросов к API

1. Откройте DevTools → Network
2. Очистите localStorage (`loginus-language`) и sessionStorage
3. Сделайте hard reload страницы (Cmd+Shift+R / Ctrl+Shift+R)
4. Откройте `/en/dashboard`
5. Проверьте запросы к `/api/v2/translations/en/`:
   - Должно быть 3-5 запросов (common, profile, dashboard, data, modals)
   - Не должно быть запросов ко всем модулям сразу

### 2. Проверка скорости загрузки

1. Откройте DevTools → Performance
2. Запишите профиль загрузки страницы `/en/dashboard`
3. Проверьте метрики:
   - **FCP (First Contentful Paint)**: < 2 секунды
   - **TTI (Time to Interactive)**: < 3 секунды
   - **LCP (Largest Contentful Paint)**: < 2.5 секунды

### 3. Проверка использования кэша

1. Откройте `/en/dashboard` первый раз (запись в кэш)
2. Перезагрузите страницу (Cmd+R / Ctrl+R)
3. Проверьте Network - запросы к API должны быть быстрее или из кэша
4. Проверьте в консоли: `[i18n-v2] Loaded en/common from cache`

### 4. Проверка переключения языка

1. Откройте `/en/dashboard`
2. Переключите язык на русский через LanguageSwitcher
3. Проверьте Network - должно быть только 3 запроса (common, profile, dashboard)
4. Проверьте время переключения в Performance tab

## Проверка в консоли

```javascript
// Проверка текущего языка
window.i18next?.language; // должно быть 'en' на /en/dashboard

// Проверка загруженных модулей (только в dev режиме)
// Модули отслеживаются в loadedModules Map в config.ts

// Проверка document.lang
document.documentElement.lang; // должно быть 'en' на /en/dashboard
```

## Критерии успеха

- ✅ Страница `/en/dashboard` загружается быстро (< 2 секунды до первого рендера)
- ✅ При загрузке страницы делается не более 3-5 запросов к API переводов
- ✅ Sidebar сразу отображает переводы на английском без мигания русских строк
- ✅ В DOM нет русских строк и ключей переводов
- ✅ `document.documentElement.lang === 'en'` при заходе на `/en/dashboard`
- ✅ Переключение языка работает быстро (< 500ms) и сохраняет текущую страницу

