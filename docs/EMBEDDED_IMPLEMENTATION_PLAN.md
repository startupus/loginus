# üìä –û—Ü–µ–Ω–∫–∞ —Å–ª–æ–∂–Ω–æ—Å—Ç–∏ —Ä–µ–∞–ª–∏–∑–∞—Ü–∏–∏ Embedded –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–π —Å –ø–ª–∞–≥–∏–Ω–∞–º–∏

## üéØ –¶–µ–ª—å

–†–µ–∞–ª–∏–∑–æ–≤–∞—Ç—å –ø–æ–ª–Ω–æ—Ü–µ–Ω–Ω—É—é –ø–æ–¥–¥–µ—Ä–∂–∫—É **Embedded –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–π** —Å –≤–æ–∑–º–æ–∂–Ω–æ—Å—Ç—å—é –∑–∞–≥—Ä—É–∑–∫–∏ –ø–ª–∞–≥–∏–Ω–æ–≤ –≤ —ç—Ç–æ–º —Ñ–æ—Ä–º–∞—Ç–µ.

## üìã –¢–µ–∫—É—â–µ–µ —Å–æ—Å—Ç–æ—è–Ω–∏–µ

### ‚úÖ –ß—Ç–æ —É–∂–µ –µ—Å—Ç—å:

1. **EmbeddedAppPage** (`frontend/src/pages/EmbeddedAppPage.tsx`)
   - –ë–∞–∑–æ–≤—ã–π —Ä–µ–Ω–¥–µ—Ä–∏–Ω–≥ —á–µ—Ä–µ–∑ iframe
   - –ü–æ–¥–¥–µ—Ä–∂–∫–∞ launch API (`POST /plugins/:slug/launch`)
   - –û—Ç–ø—Ä–∞–≤–∫–∞ initData —á–µ—Ä–µ–∑ postMessage
   - –û–±—Ä–∞–±–æ—Ç–∫–∞ —Å–æ–æ–±—â–µ–Ω–∏–π –æ—Ç –ø–ª–∞–≥–∏–Ω–∞

2. **Backend —Å—Ç—Ä—É–∫—Ç—É—Ä–∞ –¥–ª—è –ø–ª–∞–≥–∏–Ω–æ–≤:**
   - `ExtensionUploadService` - –∑–∞–≥—Ä—É–∑–∫–∞ –ø–ª–∞–≥–∏–Ω–æ–≤
   - `PluginRegistryService` - —Ä–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—è –ø–ª–∞–≥–∏–Ω–æ–≤
   - `Extension` entity - —Ö—Ä–∞–Ω–µ–Ω–∏–µ –º–µ—Ç–∞–¥–∞–Ω–Ω—ã—Ö

3. **Iframe –ø–ª–∞–≥–∏–Ω—ã:**
   - –ü–æ–ª–Ω–æ—Å—Ç—å—é —Ä–∞–±–æ—Ç–∞—é—Ç
   - –ü–æ–¥–¥–µ—Ä–∂–∫–∞ backend –∫–æ–¥–∞
   - –ü–µ—Ä–µ–¥–∞—á–∞ —Ç–æ–∫–µ–Ω–∞ —á–µ—Ä–µ–∑ postMessage

## üîß –ß—Ç–æ –Ω—É–∂–Ω–æ —Ä–µ–∞–ª–∏–∑–æ–≤–∞—Ç—å

### **1. Backend: Launch API –¥–ª—è Embedded –ø–ª–∞–≥–∏–Ω–æ–≤**

**–°–ª–æ–∂–Ω–æ—Å—Ç—å: üü° –°—Ä–µ–¥–Ω—è—è**

**–ß—Ç–æ –Ω—É–∂–Ω–æ:**
- –°–æ–∑–¥–∞—Ç—å endpoint `POST /api/v2/plugins/:slug/launch`
- –ì–µ–Ω–µ—Ä–∏—Ä–æ–≤–∞—Ç—å `initData` (–¥–∞–Ω–Ω—ã–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è, —Ç–æ–∫–µ–Ω, –Ω–∞—Å—Ç—Ä–æ–π–∫–∏)
- –í–æ–∑–≤—Ä–∞—â–∞—Ç—å `launchUrl` –∏ `initData`
- –í–∞–ª–∏–¥–∞—Ü–∏—è –ø–ª–∞–≥–∏–Ω–∞ (–ø—Ä–æ–≤–µ—Ä–∫–∞ —Ç–∏–ø–∞, enabled, permissions)

**–û—Ü–µ–Ω–∫–∞ –≤—Ä–µ–º–µ–Ω–∏:** 4-6 —á–∞—Å–æ–≤

**–§–∞–π–ª—ã:**
- `backend/src/core/extensions/plugins-launch.controller.ts` (–Ω–æ–≤—ã–π)
- `backend/src/core/extensions/plugins-launch.service.ts` (–Ω–æ–≤—ã–π)
- –û–±–Ω–æ–≤–∏—Ç—å `backend/src/core/core.module.ts`

**–ü—Ä–∏–º–µ—Ä —Ä–µ–∞–ª–∏–∑–∞—Ü–∏–∏:**
```typescript
@Post(':slug/launch')
async launchPlugin(
  @Param('slug') slug: string,
  @Body() dto: LaunchPluginDto,
  @Req() req: Request
) {
  const user = req.user;
  const plugin = await this.registry.findBySlug(slug);
  
  if (!plugin || plugin.extensionType !== 'embedded') {
    throw new NotFoundException('Plugin not found');
  }

  const initData = {
    userId: user.id,
    token: generateToken(user),
    locale: dto.locale,
    location: dto.location,
    timestamp: Date.now(),
  };

  const launchUrl = plugin.config?.launchUrl || plugin.config?.baseUrl;
  
  return {
    success: true,
    data: {
      launchUrl,
      initData: signInitData(initData),
    },
  };
}
```

### **2. Frontend: –ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è Embedded –ø–ª–∞–≥–∏–Ω–æ–≤ –≤ –º–µ–Ω—é**

**–°–ª–æ–∂–Ω–æ—Å—Ç—å: üü¢ –ù–∏–∑–∫–∞—è**

**–ß—Ç–æ –Ω—É–∂–Ω–æ:**
- –û–±–Ω–æ–≤–∏—Ç—å `PageTemplate.tsx` –¥–ª—è –≥–µ–Ω–µ—Ä–∞—Ü–∏–∏ –ø—Ä–∞–≤–∏–ª—å–Ω–æ–≥–æ `navigationPath` –¥–ª—è embedded
- –û–±–Ω–æ–≤–∏—Ç—å `MenuSettingsPage.tsx` –¥–ª—è –≤—ã–±–æ—Ä–∞ –ø–ª–∞–≥–∏–Ω–æ–≤ —Ç–∏–ø–∞ `embedded`
- –û–±–Ω–æ–≤–∏—Ç—å `Sidebar.tsx` –¥–ª—è –Ω–∞–≤–∏–≥–∞—Ü–∏–∏ –Ω–∞ `/embedded/:slug`

**–û—Ü–µ–Ω–∫–∞ –≤—Ä–µ–º–µ–Ω–∏:** 2-3 —á–∞—Å–∞

**–ò–∑–º–µ–Ω–µ–Ω–∏—è:**
```typescript
// –í PageTemplate.tsx
if (item.type === 'embedded' && item.pluginId) {
  const plugin = plugins.find(p => p.id === item.pluginId);
  if (plugin) {
    navigationPath = `/${currentLang}/embedded/${plugin.slug}`;
  }
}
```

### **3. –§–æ—Ä–º–∞—Ç –ø–ª–∞–≥–∏–Ω–∞ –¥–ª—è Embedded**

**–°–ª–æ–∂–Ω–æ—Å—Ç—å: üü° –°—Ä–µ–¥–Ω—è—è**

**–ß—Ç–æ –Ω—É–∂–Ω–æ:**
- –û–±–Ω–æ–≤–∏—Ç—å `manifest.json` –¥–ª—è embedded –ø–ª–∞–≥–∏–Ω–æ–≤
- –î–æ–±–∞–≤–∏—Ç—å –ø–æ–ª—è: `launchUrl`, `sdkVersion`, `permissions`
- –û–±–Ω–æ–≤–∏—Ç—å `ExtensionUploadService` –¥–ª—è –æ–±—Ä–∞–±–æ—Ç–∫–∏ embedded –ø–ª–∞–≥–∏–Ω–æ–≤

**–û—Ü–µ–Ω–∫–∞ –≤—Ä–µ–º–µ–Ω–∏:** 3-4 —á–∞—Å–∞

**–ü—Ä–∏–º–µ—Ä manifest.json:**
```json
{
  "name": "my-embedded-app",
  "type": "menu_item",
  "config": {
    "renderType": "embedded",
    "entrypoint": "index.html",
    "launchUrl": "https://app.example.com",
    "sdkVersion": "1.0.0"
  },
  "permissions": {
    "api": ["read:user", "write:data"],
    "storage": ["localStorage", "sessionStorage"]
  }
}
```

### **4. SDK –¥–ª—è Embedded –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–π**

**–°–ª–æ–∂–Ω–æ—Å—Ç—å: üî¥ –í—ã—Å–æ–∫–∞—è**

**–ß—Ç–æ –Ω—É–∂–Ω–æ:**
- –°–æ–∑–¥–∞—Ç—å JavaScript SDK –¥–ª—è embedded –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–π
- –†–µ–∞–ª–∏–∑–æ–≤–∞—Ç—å –º–µ—Ç–æ–¥—ã:
  - `LoginusSDK.init()` - –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è
  - `LoginusSDK.getUser()` - –ø–æ–ª—É—á–µ–Ω–∏–µ –¥–∞–Ω–Ω—ã—Ö –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
  - `LoginusSDK.navigate()` - –Ω–∞–≤–∏–≥–∞—Ü–∏—è –≤ —Ö–æ—Å—Ç–µ
  - `LoginusSDK.emitEvent()` - –æ—Ç–ø—Ä–∞–≤–∫–∞ —Å–æ–±—ã—Ç–∏–π
  - `LoginusSDK.request()` - API –∑–∞–ø—Ä–æ—Å—ã
- –î–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è –∏ –ø—Ä–∏–º–µ—Ä—ã

**–û—Ü–µ–Ω–∫–∞ –≤—Ä–µ–º–µ–Ω–∏:** 8-12 —á–∞—Å–æ–≤

**–ü—Ä–∏–º–µ—Ä SDK:**
```javascript
// –í embedded –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–∏
const sdk = new LoginusSDK();
await sdk.init();

const user = await sdk.getUser();
console.log('User:', user);

sdk.navigate('/dashboard');
sdk.emitEvent('user_action', { action: 'click' });
```

### **5. –ë–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å –∏ –≤–∞–ª–∏–¥–∞—Ü–∏—è**

**–°–ª–æ–∂–Ω–æ—Å—Ç—å: üü° –°—Ä–µ–¥–Ω—è—è**

**–ß—Ç–æ –Ω—É–∂–Ω–æ:**
- –í–∞–ª–∏–¥–∞—Ü–∏—è initData (–ø–æ–¥–ø–∏—Å—å, timestamp, expiration)
- CORS –Ω–∞—Å—Ç—Ä–æ–π–∫–∏ –¥–ª—è embedded –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–π
- Sandbox –∞—Ç—Ä–∏–±—É—Ç—ã –¥–ª—è iframe
- –ü—Ä–æ–≤–µ—Ä–∫–∞ permissions –ø–µ—Ä–µ–¥ launch

**–û—Ü–µ–Ω–∫–∞ –≤—Ä–µ–º–µ–Ω–∏:** 4-6 —á–∞—Å–æ–≤

## üìä –û–±—â–∞—è –æ—Ü–µ–Ω–∫–∞

| –ó–∞–¥–∞—á–∞ | –°–ª–æ–∂–Ω–æ—Å—Ç—å | –í—Ä–µ–º—è | –ü—Ä–∏–æ—Ä–∏—Ç–µ—Ç |
|--------|-----------|-------|-----------|
| Launch API | üü° –°—Ä–µ–¥–Ω—è—è | 4-6—á | –í—ã—Å–æ–∫–∏–π |
| Frontend –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è | üü¢ –ù–∏–∑–∫–∞—è | 2-3—á | –í—ã—Å–æ–∫–∏–π |
| –§–æ—Ä–º–∞—Ç –ø–ª–∞–≥–∏–Ω–∞ | üü° –°—Ä–µ–¥–Ω—è—è | 3-4—á | –í—ã—Å–æ–∫–∏–π |
| SDK | üî¥ –í—ã—Å–æ–∫–∞—è | 8-12—á | –°—Ä–µ–¥–Ω–∏–π |
| –ë–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å | üü° –°—Ä–µ–¥–Ω—è—è | 4-6—á | –í—ã—Å–æ–∫–∏–π |
| **–ò–¢–û–ì–û** | | **21-31—á** | |

## üéØ –†–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–∏

### **–§–∞–∑–∞ 1: MVP (8-10 —á–∞—Å–æ–≤)**
1. ‚úÖ Launch API –¥–ª—è embedded –ø–ª–∞–≥–∏–Ω–æ–≤
2. ‚úÖ Frontend –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è –≤ –º–µ–Ω—é
3. ‚úÖ –ë–∞–∑–æ–≤—ã–π —Ñ–æ—Ä–º–∞—Ç –ø–ª–∞–≥–∏–Ω–∞
4. ‚úÖ –ú–∏–Ω–∏–º–∞–ª—å–Ω–∞—è –±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å

**–†–µ–∑—É–ª—å—Ç–∞—Ç:** Embedded –ø–ª–∞–≥–∏–Ω—ã –º–æ–∂–Ω–æ –∑–∞–≥—Ä—É–∂–∞—Ç—å –∏ –∑–∞–ø—É—Å–∫–∞—Ç—å —á–µ—Ä–µ–∑ –º–µ–Ω—é

### **–§–∞–∑–∞ 2: SDK (8-12 —á–∞—Å–æ–≤)**
1. ‚úÖ JavaScript SDK
2. ‚úÖ –î–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è
3. ‚úÖ –ü—Ä–∏–º–µ—Ä—ã –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è

**–†–µ–∑—É–ª—å—Ç–∞—Ç:** –ü–æ–ª–Ω–æ—Ü–µ–Ω–Ω–∞—è –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è embedded –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–π

### **–§–∞–∑–∞ 3: –†–∞—Å—à–∏—Ä–µ–Ω–Ω—ã–µ –≤–æ–∑–º–æ–∂–Ω–æ—Å—Ç–∏ (4-6 —á–∞—Å–æ–≤)**
1. ‚úÖ –†–∞—Å—à–∏—Ä–µ–Ω–Ω—ã–µ permissions
2. ‚úÖ –°–æ–±—ã—Ç–∏—è –∏ –∫–æ–º–º—É–Ω–∏–∫–∞—Ü–∏—è
3. ‚úÖ –ù–∞–≤–∏–≥–∞—Ü–∏—è –∏ —Ä–æ—É—Ç–∏–Ω–≥

**–†–µ–∑—É–ª—å—Ç–∞—Ç:** –ü–æ–ª–Ω–æ—Ñ—É–Ω–∫—Ü–∏–æ–Ω–∞–ª—å–Ω–∞—è –ø–ª–∞—Ç—Ñ–æ—Ä–º–∞ –¥–ª—è embedded –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–π

## üîÑ –°—Ä–∞–≤–Ω–µ–Ω–∏–µ —Å Iframe

| –§—É–Ω–∫—Ü–∏—è | Iframe | Embedded |
|---------|--------|----------|
| –ü—Ä–æ—Å—Ç–æ—Ç–∞ | ‚úÖ –û—á–µ–Ω—å –ø—Ä–æ—Å—Ç–æ | üü° –°—Ä–µ–¥–Ω–µ |
| –ë–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å | ‚úÖ –ò–∑–æ–ª—è—Ü–∏—è | üü° –¢—Ä–µ–±—É–µ—Ç –Ω–∞—Å—Ç—Ä–æ–π–∫–∏ |
| –ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è | üü° –ë–∞–∑–æ–≤–∞—è | ‚úÖ –ì–ª—É–±–æ–∫–∞—è |
| SDK | ‚ùå –ù–µ—Ç | ‚úÖ –ï—Å—Ç—å |
| Launch API | ‚ùå –ù–µ—Ç | ‚úÖ –ï—Å—Ç—å |
| InitData | ‚ùå –ù–µ—Ç | ‚úÖ –ï—Å—Ç—å |
| –ù–∞–≤–∏–≥–∞—Ü–∏—è | ‚ùå –ù–µ—Ç | ‚úÖ –ï—Å—Ç—å |

## üí° –í—ã–≤–æ–¥

**–†–µ–∞–ª–∏–∑–∞—Ü–∏—è Embedded –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–π —Å –ø–ª–∞–≥–∏–Ω–∞–º–∏:**

- ‚úÖ **–¢–µ—Ö–Ω–∏—á–µ—Å–∫–∏ –≤–æ–∑–º–æ–∂–Ω–æ** - –≤—Å–µ –∫–æ–º–ø–æ–Ω–µ–Ω—Ç—ã —É–∂–µ –µ—Å—Ç—å –∏–ª–∏ –ª–µ–≥–∫–æ –¥–æ–±–∞–≤–∏—Ç—å
- ‚úÖ **–ù–µ –æ—á–µ–Ω—å —Å–ª–æ–∂–Ω–æ** - –æ—Å–Ω–æ–≤–Ω–∞—è –ª–æ–≥–∏–∫–∞ —É–∂–µ —Ä–µ–∞–ª–∏–∑–æ–≤–∞–Ω–∞ –≤ EmbeddedAppPage
- ‚è±Ô∏è **–í—Ä–µ–º—è:** 8-10 —á–∞—Å–æ–≤ –¥–ª—è MVP, 21-31 —á–∞—Å –¥–ª—è –ø–æ–ª–Ω–æ–π —Ä–µ–∞–ª–∏–∑–∞—Ü–∏–∏
- üéØ **–†–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏—è:** –ù–∞—á–∞—Ç—å —Å MVP (Launch API + Frontend –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è)

**–ü—Ä–µ–∏–º—É—â–µ—Å—Ç–≤–∞:**
- –ì–ª—É–±–æ–∫–∞—è –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è —Å —Ö–æ—Å—Ç–æ–º
- SDK –¥–ª—è —Ä–∞–∑—Ä–∞–±–æ—Ç—á–∏–∫–æ–≤
- –ë–æ–ª–µ–µ –≥–∏–±–∫–∞—è –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞
- –ü–æ–¥–¥–µ—Ä–∂–∫–∞ —Å–ª–æ–∂–Ω—ã—Ö –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–π

**–ù–µ–¥–æ—Å—Ç–∞—Ç–∫–∏:**
- –ë–æ–ª—å—à–µ –≤—Ä–µ–º–µ–Ω–∏ –Ω–∞ —Ä–∞–∑—Ä–∞–±–æ—Ç–∫—É
- –°–ª–æ–∂–Ω–µ–µ –¥–ª—è –ø—Ä–æ—Å—Ç—ã—Ö –≤–∏–¥–∂–µ—Ç–æ–≤
- –¢—Ä–µ–±—É–µ—Ç –±–æ–ª—å—à–µ –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏–∏

## üöÄ –ü–ª–∞–Ω –¥–µ–π—Å—Ç–≤–∏–π

1. **–°–µ–π—á–∞—Å:** –û—Å—Ç–∞–≤–∏—Ç—å iframe –∫–∞–∫ –æ—Å–Ω–æ–≤–Ω–æ–π —Ñ–æ—Ä–º–∞—Ç
2. **–§–∞–∑–∞ 1 (MVP):** –†–µ–∞–ª–∏–∑–æ–≤–∞—Ç—å Launch API –∏ –±–∞–∑–æ–≤—É—é –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏—é
3. **–§–∞–∑–∞ 2:** –î–æ–±–∞–≤–∏—Ç—å SDK –∏ —Ä–∞—Å—à–∏—Ä–µ–Ω–Ω—ã–µ –≤–æ–∑–º–æ–∂–Ω–æ—Å—Ç–∏
4. **–§–∞–∑–∞ 3:** –û–ø—Ç–∏–º–∏–∑–∞—Ü–∏—è –∏ —É–ª—É—á—à–µ–Ω–∏—è

