# –°–∏—Å—Ç–µ–º–∞ –ø–µ—Ä–µ–≤–æ–¥–æ–≤ v2 –¥–ª—è Loginus UI

## üìã –û–ø–∏—Å–∞–Ω–∏–µ

–ê–ª—å—Ç–µ—Ä–Ω–∞—Ç–∏–≤–Ω–∞—è –≥–∏–±—Ä–∏–¥–Ω–∞—è —Å–∏—Å—Ç–µ–º–∞ –ø–µ—Ä–µ–≤–æ–¥–æ–≤ —Å –≤–æ–∑–º–æ–∂–Ω–æ—Å—Ç—å—é –ø–µ—Ä–µ–∫–ª—é—á–µ–Ω–∏—è –º–µ–∂–¥—É —Å—Ç–∞—Ç–∏—á–µ—Å–∫–æ–π (—Ç–µ–∫—É—â–µ–π) –∏ –¥–∏–Ω–∞–º–∏—á–µ—Å–∫–æ–π (–Ω–æ–≤–æ–π) —Å–∏—Å—Ç–µ–º–∞–º–∏ –±–µ–∑ —Ä–∞–∑—Ä—É—à–µ–Ω–∏—è —Å—É—â–µ—Å—Ç–≤—É—é—â–µ–π.

## üèóÔ∏è –ê—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞

### –ö–æ–º–ø–æ–Ω–µ–Ω—Ç—ã —Å–∏—Å—Ç–µ–º—ã

1. **types.ts** - TypeScript —Ç–∏–ø—ã –¥–ª—è —Å–∏—Å—Ç–µ–º—ã –ø–µ—Ä–µ–≤–æ–¥–æ–≤ v2
2. **config.ts** - –ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è —Å–∏—Å—Ç–µ–º—ã (—Ä–µ–∂–∏–º—ã —Ä–∞–±–æ—Ç—ã, –Ω–∞—Å—Ç—Ä–æ–π–∫–∏ –∫—ç—à–∏—Ä–æ–≤–∞–Ω–∏—è)
3. **cache.ts** - IndexedDB –∫—ç—à–∏—Ä–æ–≤–∞–Ω–∏–µ –ø–µ—Ä–µ–≤–æ–¥–æ–≤ —Å –≤–µ—Ä—Å–∏–æ–Ω–∏—Ä–æ–≤–∞–Ω–∏–µ–º
4. **api-client.ts** - API –∫–ª–∏–µ–Ω—Ç –¥–ª—è —Ä–∞–±–æ—Ç—ã —Å –±—ç–∫–µ–Ω–¥ API v2
5. **loader.ts** - –°–∏—Å—Ç–µ–º–∞ –∑–∞–≥—Ä—É–∑–∫–∏ —Å –º–Ω–æ–≥–æ—É—Ä–æ–≤–Ω–µ–≤—ã–º fallback
6. **toggle.ts** - Feature toggle –¥–ª—è –ø–µ—Ä–µ–∫–ª—é—á–µ–Ω–∏—è –º–µ–∂–¥—É —Å–∏—Å—Ç–µ–º–∞–º–∏

### –†–µ–∂–∏–º—ã —Ä–∞–±–æ—Ç—ã

- **static** - —Ç–æ–ª—å–∫–æ —Å—Ç–∞—Ç–∏—á–µ—Å–∫–∏–µ —Ñ–∞–π–ª—ã (—Ç–µ–∫—É—â–∞—è —Å–∏—Å—Ç–µ–º–∞)
- **dynamic** - —Ç–æ–ª—å–∫–æ API v2 (–Ω–æ–≤–∞—è —Å–∏—Å—Ç–µ–º–∞)
- **hybrid** - –≥–∏–±—Ä–∏–¥–Ω—ã–π —Ä–µ–∂–∏–º (API ‚Üí –∫—ç—à ‚Üí —Å—Ç–∞—Ç–∏—á–µ—Å–∫–∏–µ —Ñ–∞–π–ª—ã)

## üîÑ –°—Ç—Ä–∞—Ç–µ–≥–∏—è –∑–∞–≥—Ä—É–∑–∫–∏

–°–∏—Å—Ç–µ–º–∞ –∏—Å–ø–æ–ª—å–∑—É–µ—Ç –º–Ω–æ–≥–æ—É—Ä–æ–≤–Ω–µ–≤—ã–π fallback:

1. **Level 1**: –ö—ç—à IndexedDB (–µ—Å–ª–∏ –≤–∫–ª—é—á–µ–Ω)
2. **Level 2**: API –±—ç–∫–µ–Ω–¥–∞ v2 (–µ—Å–ª–∏ –≤–∫–ª—é—á–µ–Ω –¥–∏–Ω–∞–º–∏—á–µ—Å–∫–∏–π —Ä–µ–∂–∏–º)
3. **Level 3**: –°—Ç–∞—Ç–∏—á–µ—Å–∫–∏–µ JSON —Ñ–∞–π–ª—ã (—Ç–µ–∫—É—â–∞—è —Å–∏—Å—Ç–µ–º–∞)
4. **Level 4**: Fallback –Ω–∞ —Ä—É—Å—Å–∫–∏–π —è–∑—ã–∫
5. **Level 5**: –ü–æ–∫–∞–∑ –∫–ª—é—á–∞ –ø–µ—Ä–µ–≤–æ–¥–∞ –≤–º–µ—Å—Ç–æ —Ç–µ–∫—Å—Ç–∞

## üì¶ API —ç–Ω–¥–ø–æ–∏–Ω—Ç—ã

### GET `/api/v2/translations/:locale/:module`
–ó–∞–≥—Ä—É–∂–∞–µ—Ç –æ—Ç–¥–µ–ª—å–Ω—ã–π –º–æ–¥—É–ª—å –ø–µ—Ä–µ–≤–æ–¥–∞

**–ü—Ä–∏–º–µ—Ä:**
```typescript
GET /api/v2/translations/ru/common
```

**–û—Ç–≤–µ—Ç:**
```json
{
  "version": "1.0.0",
  "locale": "ru",
  "module": "common",
  "data": { ... },
  "timestamp": 1234567890,
  "checksum": "abc123..."
}
```

### GET `/api/v2/translations/:locale?modules=a,b,c`
–ó–∞–≥—Ä—É–∂–∞–µ—Ç –Ω–µ—Å–∫–æ–ª—å–∫–æ –º–æ–¥—É–ª–µ–π –æ–¥–Ω–æ–≤—Ä–µ–º–µ–Ω–Ω–æ

**–ü—Ä–∏–º–µ—Ä:**
```typescript
GET /api/v2/translations/ru?modules=common,dashboard
```

### GET `/api/v2/translations/:locale/version`
–ü—Ä–æ–≤–µ—Ä—è–µ—Ç –≤–µ—Ä—Å–∏—é –ø–µ—Ä–µ–≤–æ–¥–æ–≤ –¥–ª—è –ª–æ–∫–∞–ª–∏

**–ü—Ä–∏–º–µ—Ä:**
```typescript
GET /api/v2/translations/ru/version
```

**–û—Ç–≤–µ—Ç:**
```json
{
  "version": "1.0.0",
  "locale": "ru",
  "timestamp": 1234567890
}
```

### GET `/api/v2/translations/status`
–ü–æ–ª—É—á–∞–µ—Ç —Å—Ç–∞—Ç—É—Å –∏ –¥–æ—Å—Ç—É–ø–Ω—ã–µ –º–æ–¥—É–ª–∏

**–û—Ç–≤–µ—Ç:**
```json
{
  "version": "1.0.0",
  "modules": ["common", "dashboard", ...],
  "locales": ["ru", "en"],
  "lastUpdated": 1234567890
}
```

## üîß –ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è

### Environment Variables

```bash
# –†–µ–∂–∏–º —Ä–∞–±–æ—Ç—ã i18n —Å–∏—Å—Ç–µ–º—ã
VITE_I18N_MODE=hybrid  # static | dynamic | hybrid

# –ë–∞–∑–æ–≤—ã–π URL –¥–ª—è API v2
VITE_I18N_API_BASE_URL=/api/v2

# –í–µ—Ä—Å–∏—è API
VITE_I18N_API_VERSION=v2

# TTL –∫—ç—à–∞ –≤ –º–∏–ª–ª–∏—Å–µ–∫—É–Ω–¥–∞—Ö (–ø–æ —É–º–æ–ª—á–∞–Ω–∏—é 5 –º–∏–Ω—É—Ç)
VITE_I18N_CACHE_TTL=300000

# –ò–Ω—Ç–µ—Ä–≤–∞–ª –ø—Ä–æ–≤–µ—Ä–∫–∏ –≤–µ—Ä—Å–∏–∏ –ø–µ—Ä–µ–≤–æ–¥–æ–≤ (–ø–æ —É–º–æ–ª—á–∞–Ω–∏—é 5 –º–∏–Ω—É—Ç)
VITE_I18N_VERSION_CHECK_INTERVAL=300000
```

## üíª –ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ

### –ë–∞–∑–æ–≤–æ–µ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ

```typescript
import { loadModule } from '@/services/i18n/v2/loader';
import type { Locale, ModuleName } from '@/services/i18n/v2/types';

// –ó–∞–≥—Ä—É–∑–∏—Ç—å –º–æ–¥—É–ª—å
const commonData = await loadModule('ru', 'common');

// –ó–∞–≥—Ä—É–∑–∏—Ç—å –Ω–µ—Å–∫–æ–ª—å–∫–æ –º–æ–¥—É–ª–µ–π
const modules = await loadModules('ru', ['common', 'dashboard']);
```

### –ü—Ä–æ–≤–µ—Ä–∫–∞ —Ä–µ–∂–∏–º–∞ —Ä–∞–±–æ—Ç—ã

```typescript
import { getI18nMode, isDynamicI18nMode } from '@/services/i18n/v2/toggle';

const mode = getI18nMode(); // 'static' | 'dynamic' | 'hybrid'
const isDynamic = isDynamicI18nMode(); // true/false
```

### –†–∞–±–æ—Ç–∞ —Å –∫—ç—à–µ–º

```typescript
import { translationCache } from '@/services/i18n/v2/cache';

// –ü–æ–ª—É—á–∏—Ç—å –∏–∑ –∫—ç—à–∞
const cached = await translationCache.get('ru', 'common');

// –°–æ—Ö—Ä–∞–Ω–∏—Ç—å –≤ –∫—ç—à
await translationCache.set('ru', 'common', data, version, checksum, timestamp);

// –û—á–∏—Å—Ç–∏—Ç—å –∫—ç—à
await translationCache.clear();
```

## üß™ –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ

### –ü–µ—Ä–µ–∫–ª—é—á–µ–Ω–∏–µ —Ä–µ–∂–∏–º–∞ –≤ development

```typescript
import { setI18nMode } from '@/services/i18n/v2/toggle';

// –ü–µ—Ä–µ–∫–ª—é—á–∏—Ç—å –Ω–∞ –¥–∏–Ω–∞–º–∏—á–µ—Å–∫–∏–π —Ä–µ–∂–∏–º
setI18nMode('dynamic');

// –ü–µ—Ä–µ–∫–ª—é—á–∏—Ç—å –Ω–∞ –≥–∏–±—Ä–∏–¥–Ω—ã–π —Ä–µ–∂–∏–º
setI18nMode('hybrid');
```

## üìä –ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥

–°–∏—Å—Ç–µ–º–∞ –ª–æ–≥–∏—Ä—É–µ—Ç –≤—Å–µ –æ–ø–µ—Ä–∞—Ü–∏–∏ –≤ development —Ä–µ–∂–∏–º–µ:

- `[i18n-v2] Loaded {locale}/{module} from cache` - –∑–∞–≥—Ä—É–∑–∫–∞ –∏–∑ –∫—ç—à–∞
- `[i18n-v2] Loaded {locale}/{module} from API` - –∑–∞–≥—Ä—É–∑–∫–∞ —á–µ—Ä–µ–∑ API
- `[i18n-v2] Loaded {locale}/{module} from static files` - –∑–∞–≥—Ä—É–∑–∫–∞ –∏–∑ —Å—Ç–∞—Ç–∏—á–µ—Å–∫–∏—Ö —Ñ–∞–π–ª–æ–≤
- `[i18n-v2] Falling back to ru for module {module}` - fallback –Ω–∞ —Ä—É—Å—Å–∫–∏–π

## üöÄ –ü–ª–∞–Ω –º–∏–≥—Ä–∞—Ü–∏–∏

### –§–∞–∑–∞ 0: Development
- –ù–æ–≤–∞—è —Å–∏—Å—Ç–µ–º–∞ –¥–æ—Å—Ç—É–ø–Ω–∞ —Ç–æ–ª—å–∫–æ –≤ development
- –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ –∏ –æ—Ç–ª–∞–¥–∫–∞

### –§–∞–∑–∞ 1: A/B —Ç–µ—Å—Ç
- 10% –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π –Ω–∞ –Ω–æ–≤–æ–π —Å–∏—Å—Ç–µ–º–µ
- –ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥ –º–µ—Ç—Ä–∏–∫

### –§–∞–∑–∞ 2: –†–∞—Å—à–∏—Ä–µ–Ω–∏–µ
- 50% –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π –Ω–∞ –Ω–æ–≤–æ–π —Å–∏—Å—Ç–µ–º–µ

### –§–∞–∑–∞ 3: –ü–æ–ª–Ω—ã–π –ø–µ—Ä–µ—Ö–æ–¥
- 100% –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π –Ω–∞ –Ω–æ–≤–æ–π —Å–∏—Å—Ç–µ–º–µ
- –°—Ç–∞—Ä–∞—è —Å–∏—Å—Ç–µ–º–∞ –∫–∞–∫ fallback

### –§–∞–∑–∞ 4: –£–¥–∞–ª–µ–Ω–∏–µ —Å—Ç–∞—Ä–æ–π —Å–∏—Å—Ç–µ–º—ã
- –ü–æ —Ä–µ—à–µ–Ω–∏—é –∫–æ–º–∞–Ω–¥—ã

## üîç –û—Ç–ª–∞–¥–∫–∞

### –ü—Ä–æ–≤–µ—Ä–∫–∞ –¥–æ—Å—Ç—É–ø–Ω–æ—Å—Ç–∏ API

```typescript
import { translationsAPI } from '@/services/i18n/v2/api-client';

const isAvailable = await translationsAPI.isAvailable();
console.log('API v2 available:', isAvailable);
```

### –ü—Ä–æ–≤–µ—Ä–∫–∞ –≤–µ—Ä—Å–∏–∏ –ø–µ—Ä–µ–≤–æ–¥–æ–≤

```typescript
import { shouldUpdateModule } from '@/services/i18n/v2/loader';

const needsUpdate = await shouldUpdateModule('ru', 'common');
console.log('Module needs update:', needsUpdate);
```

## üìù –ü—Ä–∏–º–µ—á–∞–Ω–∏—è

- –°–∏—Å—Ç–µ–º–∞ –ø–æ–ª–Ω–æ—Å—Ç—å—é –æ–±—Ä–∞—Ç–Ω–æ —Å–æ–≤–º–µ—Å—Ç–∏–º–∞ —Å —Ç–µ–∫—É—â–µ–π —Å–∏—Å—Ç–µ–º–æ–π
- –ü—Ä–∏ –æ—à–∏–±–∫–∞—Ö –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è fallback –Ω–∞ —Å—Ç–∞—Ç–∏—á–µ—Å–∫–∏–µ —Ñ–∞–π–ª—ã
- –ö—ç—à –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –∏–Ω–≤–∞–ª–∏–¥–∏—Ä—É–µ—Ç—Å—è –ø—Ä–∏ –∏–∑–º–µ–Ω–µ–Ω–∏–∏ –≤–µ—Ä—Å–∏–∏ –ø–µ—Ä–µ–≤–æ–¥–æ–≤
- –í—Å–µ –æ–ø–µ—Ä–∞—Ü–∏–∏ –Ω–µ–±–ª–æ–∫–∏—Ä—É—é—â–∏–µ –∏ –∞—Å–∏–Ω—Ö—Ä–æ–Ω–Ω—ã–µ

