# Задачи: Наведение порядка в i18n на /dashboard

## Контекст
На странице `/dashboard` не все модули переключают перевод при смене языка. Необходимо привести страницу к эталонному состоянию и зафиксировать метод для тиражирования на остальные страницы.

## Чеклист

### 1. Подготовка и исследование
- [x] Создать чеклист задачи в `memory-bank/tasks.md`
- [x] Зафиксировать бизнес-требования/риски в `research/RESEARCH_STEP.md`
- [x] Синхронизировать исходные ожидания с текущей архитектурой i18n
- [x] Отметить новые бизнес-детали в `INFO.md` (если появятся)

### 2. Усиление инфраструктуры i18n
- [x] Обновить `frontend/src/services/i18n/v2/config.ts`: `I18N_MODE` по умолчанию `hybrid`
- [x] Расширить `AVAILABLE_MODULES/CRITICAL_MODULES` под реальные модули API v2 (добавлен `dashboard` в CRITICAL_MODULES)
- [x] Обновить `frontend/src/services/i18n/index.ts` (удалить упоминание `config-integrated`)
- [x] Синхронизировать язык с URL + `document.documentElement.lang` в `config.ts` и `LanguageRoute.tsx`
- [x] Обновить `LanguageSwitcher` для сохранения query/hash при переключении
- [x] Расширить `AVAILABLE_MODULES` в `backend-mock/src/translations-v2/translations-v2.service.ts` (добавлены `features`, `help`, `payment`, `admin`)
- [x] Добавить недостающие JSON модули в `backend-mock/data/translations/v2/*` (если нужно) - проверено, все модули на месте

### 3. Приведение /dashboard к эталону
- [x] Добавить `LanguageSwitcher` в `Header.tsx`
- [x] Обновить README разделов Layout и `LanguageSwitcher/README.md`
- [x] Заменить все сырые `Link to="/..."` и `navigate('/...')` на `buildPathWithLang`:
  - [x] `MailWidget.tsx`
  - [x] `PlusWidget.tsx`
  - [x] `ProfileCard.tsx` (уже использует buildPathWithLang для ссылки "Объединить аккаунты")
  - [x] `PayWidget.tsx`
  - [x] Другие компоненты Dashboard (`CoursesWidget`, `RoadmapWidget` уже используют)
- [x] Создать `frontend/src/utils/intl/formatters.ts` для форматирования чисел/дат
- [x] Применить форматтеры в компонентах:
  - [x] `ProfileCard.tsx` (баланс и игровые баллы)
  - [x] `MailWidget.tsx` (числа)
  - [x] `PlusWidget.tsx` (баллы)
  - [x] `PayWidget.tsx` (лимит)
  - [x] `EventsWidget.tsx` (относительное время)
  - [x] `RoadmapWidget.tsx` (даты)
- [x] Убедиться, что все блоки вызывают `t()` при рендере и подписаны на `i18n.language` (проверено)

### 4. Документация "метода" и удаление артефактов
- [x] Создать `frontend/src/components/Dashboard/README.md` с чеклистом i18n/UX
- [x] Обновить `I18N_V2_IMPLEMENTATION.md` (через I18N_V2_CONSOLIDATION.md)
- [x] Обновить `I18N_V2_USAGE.md` (добавлена секция о форматтерах)
- [x] Обновить `TEST_I18N_V2.md` (добавлены проверки форматтеров и отсутствия мигания)
- [x] Обновить корневой `README.md` (добавлена информация о utils/intl)
- [x] Обновить `research/I18N_V2_CONSOLIDATION.md` (добавлен раздел об эталонном методе)
- [x] Удалить пустую `backend-mock/src/translations/`
- [x] Обновить/удалить устаревшие документы (`DISABLE_OLD_I18N.md` помечен как устаревший)

### 5. Тестирование и проверка
- [ ] Запустить `scripts/start-all.sh`
- [ ] Запустить `npm run lint`
- [ ] Запустить `npm run test:e2e -- i18n-language-switch`
- [x] Добавить новый Playwright-кейс для проверки виджетов/formatters на `/en/dashboard`
- [ ] Зафиксировать результаты в `TEST_RESULTS.md`
- [x] Подготовить рекомендации по тиражированию метода на остальные страницы (в Dashboard/README.md)

## Примечания
- Все изменения должны быть задокументированы
- После завершения создать архив в `memory-bank/archive/`

---

# Задачи: Оптимизация админских страниц и i18n аудит (2025-11-24)

## Контекст
- Страницы админки долго грузятся из-за тяжёлых ответов API и повторного пересчёта фильтров на клиенте.
- Нужно провести аудит i18n на `/en/dashboard`, `/en/data`, `/en/data/documents`, `/en/support`, `/en/admin/backup`, исправить расхождения с эталоном.
- Запрещено менять конфигурации, требуется работать в рамках текущей архитектуры.

## Чеклист

### 1. Подготовка
- [x] Зафиксировать исследование по оптимизациям и i18n (`research/RESEARCH_STEP.md`)
- [x] Согласовать план оптимизаций с текущими API (`adminApi`, backend mock)
- [ ] Очистить `localStorage/sessionStorage`, подготовить окружение для аудита (manual)

### 2. Анализ и аудит
- [ ] Провести профилирование `UsersManagementPage` (React DevTools/профайлер), выявить узкие места
- [x] Проверить загрузку переводов и форматирование на каждой целевой странице
- [x] Зафиксировать найденные проблемы (GitHub issues / internal notes)

### 3. Оптимизация данных
- [x] Перенести тяжёлые вычисления в мемоизации (`useMemo`, словари компаний)
- [x] Адаптировать запросы к API для постраничной загрузки (TanStack Query: `keepPreviousData`, `placeholderData`)
- [ ] Рассмотреть виртуализацию таблиц (`react-window`) и внедрить без нарушения UX

### 4. Исправление i18n
- [x] Убедиться, что Sidebar и меню используют ключи переводов, не строки из API
- [x] Исправить форматирование чисел/валют по локали на всех страницах
- [x] Обновить `document.documentElement.lang` при смене языка (если есть расхождения)

### 5. Тестирование и документация
- [x] Обновить/создать Playwright кейсы для админки и ключевых страниц
- [x] Обновить README разделов с описанием оптимизаций/регрессий
- [ ] Обновить `TEST_RESULTS.md` с результатами прогона
- [x] Запустить `npm run lint` и `npm run test:e2e` (при необходимости — выборочные spec)

### 6. Финализация
- [ ] Проверить, что URL с префиксами языка сохраняются при навигации
- [ ] Подготовить финальную сводку для пользователя (по формату чеклиста)
- [ ] Обновить TODO и архив (при завершении задачи)

## Примечания
- Все изменения должны сопровождаться комментариями в коде по новым сложным участкам.
- Не добавлять новые зависимости без лицензии/аудита.

